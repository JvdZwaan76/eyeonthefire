<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fire Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
  <style>
    #map { height: 100vh; width: 100%; }
    body { margin: 0; padding: 0; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useEffect, useRef } = React;

    const MapComponent = () => {
      const mapRef = useRef(null);
      const mapContainerRef = useRef(null);

      const loadFireData = async () => {
        try {
          const response = await fetch('https://eyeonthefire.com/api/nasa/');
          if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
          const data = await response.json();
          return data;
        } catch (error) {
          console.error('Error fetching fire data:', error);
          return [
            { lat: 37.7749, lon: -122.4194, title: 'San Francisco Fire' },
            { lat: 34.0522, lon: -118.2437, title: 'Los Angeles Fire' }
          ];
        }
      };

      useEffect(() => {
        if (!mapRef.current && mapContainerRef.current) {
          mapRef.current = L.map(mapContainerRef.current).setView([36.0, -120.0], 6);
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
          }).addTo(mapRef.current);
          console.log('Map initialized');
          mapRef.current.invalidateSize(); // Force redraw
        }
      }, []);

      useEffect(() => {
        const addMarkers = async () => {
          const fires = await loadFireData();
          console.log('Fires array length:', fires.length);
          if (mapRef.current && fires.length > 0) {
            console.log('Adding markers for fires:', fires.length);
            fires.forEach(fire => {
              // Use circleMarker for debugging visibility
              L.circleMarker([fire.lat, fire.lon], { radius: 5, color: 'red' })
                .addTo(mapRef.current)
                .bindPopup(fire.title);
              console.log(`Adding marker at: ${fire.lat} ${fire.lon}`);
            });
            mapRef.current.invalidateSize(); // Ensure map updates
          }
        };
        addMarkers();
      }, []);

      return <div ref={mapContainerRef} id="map" />;
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<MapComponent />);
  </script>
</body>
</html>
