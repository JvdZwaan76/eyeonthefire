<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://unpkg.com;
    script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://unpkg.com https://static.cloudflareinsights.com;
    style-src 'self' 'unsafe-inline' https://unpkg.com;
    connect-src 'self' https://firms.modaps.eosdis.nasa.gov https://eyeonthefire.com;
    img-src 'self' https://*.tile.openstreetmap.org;
    frame-src 'self' https://firms.modaps.eosdis.nasa.gov;
  ">
  <title>Map Status</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    #map { height: 600px; width: 100%; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;

    const MapComponent = () => {
      const [fires, setFires] = useState([]);
      const [error, setError] = useState(null);

      useEffect(() => {
        let map;

        const initializeMap = () => {
          map = L.map('map').setView([37.7749, -122.4194], 5);
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
          }).addTo(map);
          console.log('Map initialized');
          return map;
        };

        const loadFireData = async () => {
          try {
            // Replace with your actual NASA FIRMS API key
            const response = await fetch('https://firms.modaps.eosdis.nasa.gov/api/area/csv/d152217c8391eb5b0fbd242290527ae8/VIIRS_SNPP_NRT/world/1');
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const csvText = await response.text();
            const parsedFires = csvText.split('\n').slice(1).map(line => {
              const [latitude, longitude] = line.split(',');
              return { lat: parseFloat(latitude), lng: parseFloat(longitude) };
            }).filter(fire => fire.lat && fire.lng);
            console.log('Fetched fires:', parsedFires.length);
            setFires(parsedFires);
          } catch (err) {
            console.error('Error fetching fire data:', err);
            setError(err.message);
          }
        };

        map = initializeMap();
        loadFireData();

        return () => {
          if (map) map.remove();
        };
      }, []);

      useEffect(() => {
        if (fires.length > 0 && window.L) {
          fires.forEach(fire => {
            L.marker([fire.lat, fire.lng]).addTo(window.L.map('map'));
            console.log(`Adding marker at: ${fire.lat}, ${fire.lng}`);
          });
          console.log('Adding markers for fires:', fires.length);
        }
      }, [fires]);

      return (
        <div>
          {error && <p>Error: {error}</p>}
          <div id="map"></div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<MapComponent />);
  </script>
</body>
</html>
