<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eye on the Fire - Live US Wildfire Map | Fires Near Me Tracker</title>
    <meta name="description" content="Track wildfires near you with Eye on the Fire's live US interactive map. Get real-time updates, safety guides, and emergency resources.">
    <meta name="keywords" content="wildfire map, fires near me, US wildfire tracker, real-time fire updates, wildfire safety">
    <meta property="og:title" content="Eye on the Fire - Live US Wildfire Map">
    <meta property="og:description" content="Track wildfires in real-time with our interactive US map. Stay informed and safe with updates and resources.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://eyeonthefire.com/">
    <meta property="og:image" content="https://eyeonthefire.com/images/hero-bg.jpg">
    <link rel="canonical" href="https://eyeonthefire.com/">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="styles.css">
    <!-- Favicon Links -->
    <link rel="shortcut icon" href="/favicon/favicon.ico" type="image/x-icon">
    <link rel="icon" type="image/png" href="/favicon/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/favicon/favicon-16x16.png" sizes="16x16">
    <link rel="apple-touch-icon" href="/favicon/apple-touch-icon.png" sizes="180x180">
    <link rel="manifest" href="/favicon/site.webmanifest">
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-T8RE6KDBEW"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-T8RE6KDBEW');
    </script>
    <style>
        .map-wrapper #map-container {
            position: relative;
            height: 600px;
            width: 100%;
            overflow: hidden;
        }
        .map-wrapper #map {
            height: 100%;
            width: 100%;
        }
        .map-wrapper #sidebar {
            position: absolute;
            top: 0;
            left: 0;
            width: 300px;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.2);
            overflow-y: auto;
            z-index: 1000;
            transition: transform 0.3s ease;
        }
        .map-wrapper #sidebar.collapsed {
            transform: translateX(-300px);
        }
        .map-wrapper #toggle-sidebar {
            position: absolute;
            left: 300px;
            top: 10px;
            background: white;
            padding: 8px 12px;
            border-radius: 0 4px 4px 0;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            z-index: 1000;
            transition: left 0.3s ease;
        }
        .map-wrapper #toggle-sidebar.collapsed {
            left: 0;
        }
        .map-wrapper .sidebar-content {
            padding: 15px;
            font-size: 0.9rem;
        }
        .map-wrapper .sidebar-header {
            padding: 15px;
            border-bottom: 1px solid #ddd;
            background-color: #f8f9fa;
        }
        .map-wrapper .sidebar-section {
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }
        .map-wrapper .sidebar-section h5 {
            margin-bottom: 10px;
            color: #333;
            font-size: 1rem;
        }
        .map-wrapper .form-group {
            margin-bottom: 12px;
        }
        .map-wrapper label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }
        .map-wrapper .map-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 900;
        }
        .map-wrapper .map-control-btn {
            background: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 4px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            margin-bottom: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: #555;
        }
        .map-wrapper .map-control-btn:hover {
            background: #f0f0f0;
        }
        .map-wrapper #legend {
            position: absolute;
            bottom: 30px;
            right: 10px;
            background: white;
            padding: 10px;
            border-radius: 4px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            z-index: 900;
            max-width: 240px;
            font-size: 11px;
        }
        @media (max-width: 640px) {
            .map-wrapper #legend {
                bottom: 10px;
                right: 10px;
                padding: 8px;
                max-width: 180px;
                font-size: 10px;
            }
            .map-wrapper #sidebar {
                width: 260px;
            }
            .map-wrapper #toggle-sidebar {
                left: 260px;
            }
            .map-wrapper .map-control-btn {
                width: 36px;
                height: 36px;
                font-size: 16px;
                margin-bottom: 4px;
            }
        }
        .map-wrapper .legend-item {
            display: flex;
            align-items: center;
            margin: 4px 0;
        }
        .map-wrapper .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 8px;
            border: 1px solid #ddd;
        }
        .map-wrapper #status-panel {
            position: absolute;
            bottom: 30px;
            left: 310px;
            background: white;
            padding: 10px 15px;
            border-radius: 4px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            z-index: 900;
            max-width: 400px;
            font-size: 14px;
            display: none;
            transition: left 0.3s ease;
        }
        .map-wrapper #status-panel.sidebar-collapsed {
            left: 10px;
        }
        .map-wrapper .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        .map-wrapper .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        .map-wrapper #custom-tooltip {
            position: absolute;
            display: none;
            background: white;
            padding: 5px 10px;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            font-size: 12px;
            pointer-events: none;
            z-index: 9999;
        }
        .map-wrapper .region-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 15px 20px;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            display: none;
            z-index: 1001;
            text-align: center;
            max-width: 80%;
        }
        .map-wrapper .region-loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
            vertical-align: middle;
        }
        .map-wrapper .loading-data-message {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 8px 15px;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            display: none;
            z-index: 1001;
            text-align: center;
            white-space: nowrap;
        }
        .map-wrapper .loading-data-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
            vertical-align: middle;
        }
        .map-wrapper #view-mode-toggle {
            position: absolute;
            bottom: 70px;
            left: 310px;
            z-index: 900;
            transition: left 0.3s ease;
        }
        .map-wrapper #view-mode-toggle.sidebar-collapsed {
            left: 10px;
        }
        .map-wrapper .filter-tag {
            display: inline-block;
            background: #e9f5ff;
            color: #0066cc;
            padding: 3px 8px;
            border-radius: 15px;
            margin: 0 5px 5px 0;
            font-size: 0.8rem;
        }
        .map-wrapper .filter-tag .remove-filter {
            margin-left: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        .map-wrapper .region-button {
            display: inline-block;
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 0 4px 4px 0;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s ease;
        }
        .map-wrapper .region-button:hover {
            background-color: #f0f0f0;
        }
        .map-wrapper .region-button.active {
            background-color: #007bff;
            color: white;
            border-color: #0069d9;
        }
        .map-wrapper .region-buttons {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }
        .map-wrapper #stats-panel {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            width: 80%;
            max-width: 500px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 1100;
            display: none;
        }
        .map-wrapper .stats-title {
            padding: 15px;
            border-bottom: 1px solid #ddd;
            font-weight: bold;
            font-size: 1.1rem;
        }
        .map-wrapper #stats-content {
            padding: 15px;
            max-height: 70vh;
            overflow-y: auto;
        }
        .map-wrapper .color-scale {
            height: 10px;
            display: flex;
            margin-top: 4px;
        }
        .map-wrapper .color-scale div {
            flex: 1;
            height: 100%;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <header class="navbar">
        <div class="navbar-container">
            <a href="index.html" class="logo-link">
                <div class="logo-container">
                    <img src="/images/eyeonthefire-logo.png" alt="Eye on the Fire Logo" id="navbar-logo">
                    <span>Eye on the Fire</span>
                </div>
            </a>
            <button class="hamburger" aria-label="Toggle navigation" aria-expanded="false">
                <span class="line line1"></span>
                <span class="line line2"></span>
                <span class="line line3"></span>
            </button>
            <nav class="nav-menu" id="main-nav">
                <ul class="main-menu">
                    <li><a href="index.html" class="active">Home</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="prepare.html">Prepare</a></li>
                    <li><a href="prevent.html">Prevent</a></li>
                    <li><a href="safety-info.html">Safety Info</a></li>
                    <li><a href="news-resources.html">News & Resources</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>
    <section class="hero" id="home">
        <div class="hero-content">
            <h1>Monitor US Wildfires in Real-Time</h1>
            <p>Track active fires across the United States with our live interactive map. Get critical updates, safety alerts, and preparedness resources.</p>
            <a href="#map-section" class="cta-button">View Live US Fire Map</a>
        </div>
    </section>
    <section id="intro" class="content-section">
        <div class="container">
            <p class="section-intro">Welcome to Eye on the Fire, your central hub for tracking active <strong>wildfires near me</strong> across the United States. Our advanced <strong>interactive fire map</strong> provides <strong>real-time fire monitoring</strong>, helping you stay aware of developing situations and make informed decisions for your safety during the challenging <strong>US fire season</strong>. Explore the map below and utilize our resources for effective <strong>wildfire safety</strong> and <strong>emergency preparedness</strong>.</p>
        </div>
    </section>
    <hr class="section-divider">
    <section id="map-section" class="content-section">
        <div class="container">
            <h2 class="section-title">Interactive Live US Wildfire Tracker</h2>
            <p class="section-intro">Monitor the latest wildfire activity nationwide. Use the map controls to find <strong>fires near you</strong> anywhere in the US, zoom into specific regions, and explore data layers for a comprehensive view of <strong>current wildfires</strong> and activity.</p>
            <div class="map-usage-guide" role="region" aria-labelledby="map-guide-heading">
                <h4 id="map-guide-heading"><i class="fas fa-map-marked-alt" aria-hidden="true"></i> How to Use the Map:</h4>
                <ul>
                    <li><i class="fas fa-location-crosshairs" aria-hidden="true"></i><span>Click <strong>Locate Me</strong> to center the map on your current position and find potential <strong>wildfires near me</strong>.</span></li>
                    <li><i class="fas fa-search-plus" aria-hidden="true"></i><span>Use the <strong>+/- buttons</strong> or pinch/scroll to zoom in and out for regional detail.</span></li>
                    <li><i class="fas fa-undo" aria-hidden="true"></i><span>Click <strong>Reset View</strong> to return to the initial nationwide map extent.</span></li>
                    <li><i class="fas fa-fire" aria-hidden="true"></i><span>Fire icons indicate detected hotspots or reported incidents. Click icons for available details.</span></li>
                </ul>
            </div>
        </div>
        <main>
            <div class="map-wrapper">
                <div id="map-container">
                    <div id="map"></div>
                    <!-- Custom Tooltip -->
                    <div id="custom-tooltip"></div>
                    <!-- Sidebar -->
                    <div id="sidebar">
                        <div class="sidebar-header">
                            <h4><i class="fas fa-fire-flame-curved"></i> USA Fire Map</h4>
                            <p class="text-muted mb-0" style="font-size: 12px;">NASA FIRMS Real-Time Fire Data</p>
                        </div>
                        <div class="sidebar-content">
                            <div id="active-filters"></div>
                            <div class="sidebar-section">
                                <h5>Quick View</h5>
                                <div class="region-buttons">
                                    <div id="usa-button" class="region-button active" data-bounds="-125,24,-66,49">USA</div>
                                    <div id="west-button" class="region-button" data-bounds="-125,31,-107,49">West</div>
                                    <div id="central-button" class="region-button" data-bounds="-107,31,-90,49">Central</div>
                                    <div id="east-button" class="region-button" data-bounds="-90,24,-66,49">East</div>
                                    <div id="alaska-button" class="region-button" data-bounds="-170,51,-130,71">Alaska</div>
                                    <div id="hawaii-button" class="region-button" data-bounds="-160,18,-154,23">Hawaii</div>
                                </div>
                            </div>
                            <div class="sidebar-section">
                                <h5>Data Source</h5>
                                <div class="form-group">
                                    <select id="data-source" class="form-select form-select-sm">
                                        <option value="MODIS_NRT">MODIS (Near Real-Time)</option>
                                        <option value="VIIRS_NOAA20_NRT">VIIRS NOAA-20 (Near Real-Time)</option>
                                        <option value="VIIRS_SNPP_NRT">VIIRS Suomi NPP (Near Real-Time)</option>
                                        <option value="VIIRS_NOAA21_NRT">VIIRS NOAA-21 (Near Real-Time)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="sidebar-section">
                                <h5>Time Range</h5>
                                <div class="form-group">
                                    <select id="days-range" class="form-select form-select-sm">
                                        <option value="1">Last 24 hours</option>
                                        <option value="2">Last 2 days</option>
                                        <option value="3">Last 3 days</option>
                                        <option value="7">Last 7 days</option>
                                        <option value="10">Last 10 days</option>
                                    </select>
                                </div>
                            </div>
                            <div class="sidebar-section">
                                <h5>Fire Filters</h5>
                                <div class="form-group">
                                    <label for="confidence-range">Confidence Level: <span id="confidence-min">0%</span></label>
                                    <input type="range" class="form-range" id="confidence-range" min="0" max="100" value="0">
                                </div>
                                <div class="form-group">
                                    <label for="frp-range">Fire Power (MW): <span id="frp-min">0</span></label>
                                    <input type="range" class="form-range" id="frp-range" min="0" max="100" value="0">
                                </div>
                            </div>
                            <div class="sidebar-section">
                                <h5>Display Options</h5>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="enable-clustering" checked>
                                    <label class="form-check-label" for="enable-clustering">Enable Clustering</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="show-heatmap">
                                    <label class="form-check-label" for="show-heatmap">Show Heatmap</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="lazy-loading" checked>
                                    <label class="form-check-label" for="lazy-loading">Lazy Load Data (Recommended)</label>
                                    <small class="form-text text-muted d-block">Only loads data for visible map area</small>
                                </div>
                                <div class="form-group mt-2">
                                    <label for="markers-per-page">Max Visible Markers</label>
                                    <select id="markers-per-page" class="form-select form-select-sm">
                                        <option value="500">500 (Fast)</option>
                                        <option value="1000" selected>1,000 (Balanced)</option>
                                        <option value="3000">3,000 (Detailed)</option>
                                        <option value="10000">10,000 (Full)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="sidebar-section">
                                <button id="apply-filters" class="btn btn-primary btn-sm w-100">
                                    <i class="fas fa-filter"></i> Apply Filters
                                </button>
                                <button id="reset-filters" class="btn btn-outline-secondary btn-sm w-100 mt-2">
                                    <i class="fas fa-sync"></i> Reset Filters
                                </button>
                            </div>
                            <div class="pagination-container">
                                <div class="btn-group pagination">
                                    <button id="prev-page" class="btn btn-sm btn-outline-secondary">
                                        <i class="fas fa-chevron-left"></i>
                                    </button>
                                    <span id="page-info" class="btn btn-sm btn-outline-secondary disabled">
                                        <span id="current-page">1</span>/<span id="total-pages">1</span>
                                    </span>
                                    <button id="next-page" class="btn btn-sm btn-outline-secondary">
                                        <i class="fas fa-chevron-right"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="toggle-sidebar">
                        <i class="fas fa-chevron-left"></i>
                    </div>
                    <!-- Map Controls -->
                    <div class="map-controls">
                        <button class="map-control-btn" id="zoom-in" title="Zoom In">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="map-control-btn" id="zoom-out" title="Zoom Out">
                            <i class="fas fa-minus"></i>
                        </button>
                        <button class="map-control-btn" id="recenter" title="Recenter Map">
                            <i class="fas fa-location-crosshairs"></i>
                        </button>
                        <button class="map-control-btn" id="show-stats" title="Show Statistics">
                            <i class="fas fa-chart-simple"></i>
                        </button>
                    </div>
                    <!-- Legend -->
                    <div id="legend">
                        <h6 style="font-size: 12px; margin-top: 0;">Fire Confidence</h6>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #FF0000;"></div>
                            <span>High (80-100%)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #FF4500;"></div>
                            <span>Medium (60-79%)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #FFA500;"></div>
                            <span>Low (30-59%)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #FFCC00;"></div>
                            <span>Very Low (0-29%)</span>
                        </div>
                        <div style="margin-top: 6px; font-size: 10px;">
                            <strong>Circle Size:</strong> Fire Power (MW)
                        </div>
                        <div class="color-scale">
                            <div style="background-color: #FFCC00;"></div>
                            <div style="background-color: #FFA500;"></div>
                            <div style="background-color: #FF4500;"></div>
                            <div style="background-color: #FF0000;"></div>
                        </div>
                    </div>
                    <!-- Status Panel -->
                    <div id="status-panel"></div>
                    <!-- View Mode Toggle -->
                    <div id="view-mode-toggle">
                        <button id="global-mode" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-globe"></i> Global View
                        </button>
                        <button id="usa-mode" class="btn btn-sm btn-primary">
                            <i class="fas fa-flag-usa"></i> USA Only
                        </button>
                    </div>
                    <!-- Region Loading Indicator -->
                    <div id="region-loading" class="region-loading">
                        <span class="region-loading-spinner"></span>
                        Loading fire data for this region...
                    </div>
                    <!-- Loading Data Message -->
                    <div id="loading-data-message" class="loading-data-message">
                        <span class="loading-data-spinner"></span>
                        Loading USA fire data...
                    </div>
                    <!-- Stats Panel -->
                    <div id="stats-panel">
                        <div class="stats-title">
                            <i class="fas fa-chart-simple"></i> Fire Statistics
                            <button type="button" class="btn-close float-end" id="close-stats" aria-label="Close"></button>
                        </div>
                        <div id="stats-content"></div>
                    </div>
                    <!-- Loading Overlay -->
                    <div class="loading-overlay" id="loading-overlay">
                        <div class="spinner"></div>
                        <p id="loading-message">Initializing map...</p>
                    </div>
                </div>
            </div>
        </main>
        <div class="container data-source-note">
            <small>Map data sourced from NASA FIRMS, NIFC, and other official US channels. Updates occur periodically. Always follow guidance from local emergency management officials.</small>
        </div>
    </section>
    <hr class="section-divider">
    <section id="about" class="content-section">
        <div class="container">
            <h2 class="section-title">Stay Informed, Stay Safe Nationwide</h2>
            <p class="section-intro">As wildfire risks impact communities across the <strong>United States</strong>, access to reliable, timely information is paramount. Eye on the Fire provides an essential service through our premier <strong>interactive fire map</strong>, consolidating data for clear, actionable insights nationwide. Our platform aids residents from coast to coast in assessing potential threats with <strong>real-time fire monitoring</strong>. Understanding current fire behavior is key to effective <strong>emergency preparedness</strong> and comprehensive <strong>fire safety</strong>. Trust Eye on the Fire for situational awareness.</p>
        </div>
    </section>
    <hr class="section-divider">
    <section id="prevention" class="content-section">
        <div class="container">
            <h2 class="section-title">Wildfire Prevention & Home Safety Guides</h2>
            <p class="section-intro">Protecting your property starts long before a wildfire approaches. Implementing <strong>fire prevention</strong> strategies like <strong>home hardening</strong> and creating <strong>defensible space</strong> are the most effective ways to increase your home's chance of survival, regardless of your location in the US. Explore these fundamental guides to build your <strong>wildfire action plan</strong>.</p>
            <div class="prevention-grid">
                <div class="prevention-item">
                    <i class="fas fa-home" aria-hidden="true"></i>
                    <h3>Defensible Space Zones</h3>
                    <p>Learn how to create and maintain recommended buffer zones around your home to reduce flammable vegetation and help stop fire spread. Essential nationwide guidance.</p>
                </div>
                <div class="prevention-item">
                    <i class="fas fa-tools" aria-hidden="true"></i>
                    <h3>Home Hardening Techniques</h3>
                    <p>Discover methods to make your home more resistant to embers and flames, focusing on roofs, vents, windows, siding, and decks applicable across the US.</p>
                </div>
                <div class="prevention-item">
                    <i class="fas fa-seedling" aria-hidden="true"></i>
                    <h3>Fire-Smart Landscaping</h3>
                    <p>Choose appropriate vegetation and spacing for plants near your home. Utilize fire-resistant native plants and maintain adequate irrigation for your climate zone.</p>
                </div>
            </div>
        </div>
    </section>
    <hr class="section-divider">
    <section id="community" class="content-section">
        <div class="container">
            <h2 class="section-title">National & Local Resources</h2>
            <p class="section-intro">Access official resources for emergency alerts, evacuation status, and support during wildfire events across the United States.</p>
            <div class="cta-banner">
                <p>Find National Interagency Fire Center (NIFC) Updates: <a href="https://www.nifc.gov/" target="_blank" rel="noopener noreferrer">Visit NIFC.gov</a></p>
            </div>
            <div class="gallery" role="list" aria-label="Community and wildfire images">
                <div class="gallery-item" role="listitem"><img src="/images/us-wildfire-community-response.jpg" alt="Diverse group of community members clearing brush together for wildfire prevention in a US neighborhood"></div>
                <div class="gallery-item" role="listitem"><img src="/images/us-firefighters-working.jpg" alt="US firefighters monitoring a controlled burn or wildfire line in a forested area"></div>
                <div class="gallery-item" role="listitem"><img src="/images/us-wildfire-landscape-recovery.jpg" alt="Wide landscape view showing ecological recovery with green shoots emerging after a US wildfire"></div>
            </div>
        </div>
    </section>
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-section about">
                <h3 class="logo-text-footer">Eye on the Fire</h3>
                <p>Providing critical real-time wildfire monitoring and fire safety resources for the United States. Our interactive map helps you stay informed and prepared.</p>
            </div>
            <div class="footer-section links">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="about.html">About</a></li>
                    <li><a href="prepare.html">Prepare</a></li>
                    <li><a href="prevent.html">Prevent</a></li>
                    <li><a href="safety-info.html">Safety Info</a></li>
                    <li><a href="news-resources.html">News & Resources</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </div>
            <div class="footer-section social">
                <h3>Follow Us</h3>
                <div class="social-icons">
                    <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                    <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                    <a href="#" aria-label="RSS Feed"><i class="fas fa-rss"></i></a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            © <span id="year"></span> Eye on the Fire | All Rights Reserved | Data provided "as is" without warranty |
            <a href="#">Terms of Use</a> |
            <a href="#">Privacy Policy</a>
        </div>
    </footer>
    <script src="https://unpkg.com/@googlemaps/markerclusterer@2.0.15/dist/index.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        class FireMap {
            constructor() {
                this.config = {
                    apiEndpoint: '/api/nasa/firms', // Changed to relative path for Cloudflare compatibility
                    defaultCenter: { lat: 39.5, lng: -98.35 },
                    defaultZoom: 4,
                    usBounds: { west: -125, south: 24, east: -66, north: 49 },
                    maxFetchRetries: 3,
                    mobileBreakpoint: 768
                };
                this.state = {
                    map: null,
                    viewport: { north: 0, south: 0, east: 0, west: 0 },
                    mapBounds: null,
                    markers: [],
                    markerClusterer: null,
                    heatmap: null,
                    totalFirePoints: 0,
                    filteredData: [],
                    allFireData: [],
                    currentPage: 1,
                    markersPerPage: 1000,
                    activeFilters: {},
                    infoWindow: null,
                    regionDataCache: new Map(),
                    viewMode: 'usa',
                    lazyLoading: true,
                    loadingRegions: new Set(),
                    isMobile: window.innerWidth < 768,
                    mapLoaded: false
                };
                this.initialize();
            }
            async initialize() {
                console.log('Initializing FireMap application');
                this.checkMobile();
                this.setupEventListeners();
                try {
                    await this.waitForGoogleMaps();
                    this.initializeMap();
                    this.showLoadingMessage('Loading USA fire data...');
                    await this.loadUSAFireData();
                    this.hideLoadingMessage();
                    this.state.mapLoaded = true;
                } catch (error) {
                    console.error('Error initializing application:', error);
                    this.showStatus('Error initializing application: ' + error.message, 'error');
                    this.hideLoadingMessage();
                }
            }
            checkMobile() {
                this.state.isMobile = window.innerWidth < this.config.mobileBreakpoint;
                if (this.state.isMobile) {
                    setTimeout(() => {
                        $('#sidebar').addClass('collapsed');
                        $('#toggle-sidebar').addClass('collapsed');
                        $('#toggle-sidebar i').removeClass('fa-chevron-left').addClass('fa-chevron-right');
                        $('#status-panel').addClass('sidebar-collapsed');
                        $('#view-mode-toggle').addClass('sidebar-collapsed');
                    }, 500);
                }
            }
            waitForGoogleMaps() {
                return new Promise((resolve) => {
                    const maxWaitTime = 10000; // 10 seconds maximum wait time
                    const checkInterval = 100; // Check every 100ms
                    
                    if (typeof google !== 'undefined' && typeof google.maps !== 'undefined') {
                        console.log('Google Maps already loaded');
                        resolve();
                        return;
                    }
                    
                    console.log('Waiting for Google Maps to load');
                    
                    // Create a timeout to handle the case where Google Maps doesn't load
                    const timeout = setTimeout(() => {
                        console.error('Google Maps failed to load within timeout');
                        // Still resolve to allow the app to continue with fallback
                        resolve();
                    }, maxWaitTime);
                    
                    // Check if Google Maps is loaded at regular intervals
                    const intervalId = setInterval(() => {
                        if (typeof google !== 'undefined' && typeof google.maps !== 'undefined') {
                            clearInterval(intervalId);
                            clearTimeout(timeout);
                            console.log('Google Maps loaded successfully');
                            resolve();
                        }
                    }, checkInterval);
                });
            }
            initializeMap() {
                this.showStatus('Initializing map...');
                try {
                    console.log('Creating Google Map instance');
                    // Make sure the map element exists
                    const mapElement = document.getElementById('map');
                    if (!mapElement) {
                        throw new Error('Map container element not found');
                    }
                    
                    // Check if Google Maps API is available
                    if (typeof google === 'undefined' || typeof google.maps === 'undefined') {
                        throw new Error('Google Maps API not loaded');
                    }
                    
                    this.state.map = new google.maps.Map(mapElement, {
                        center: this.config.defaultCenter,
                        zoom: this.config.defaultZoom,
                        mapTypeId: 'terrain',
                        mapTypeControl: true,
                        mapTypeControlOptions: {
                            style: google.maps.MapTypeControlStyle.DROPDOWN_MENU,
                            position: google.maps.ControlPosition.TOP_LEFT
                        },
                        fullscreenControl: false,
                        streetViewControl: false,
                        zoomControlOptions: {
                            position: google.maps.ControlPosition.RIGHT_BOTTOM
                        },
                        restriction: {
                            latLngBounds: { north: 85, south: -85, west: -180, east: 180 }
                        }
                    });
                    
                    this.state.infoWindow = new google.maps.InfoWindow();
                    
                    // Add event listener for map bounds changes
                    google.maps.event.addListener(this.state.map, 'idle', () => {
                        const bounds = this.state.map.getBounds();
                        if (bounds) {
                            const ne = bounds.getNorthEast();
                            const sw = bounds.getSouthWest();
                            this.state.viewport = {
                                north: ne.lat(),
                                east: ne.lng(),
                                south: sw.lat(),
                                west: sw.lng()
                            };
                            if (this.state.lazyLoading && this.state.mapLoaded) {
                                this.loadDataForViewport();
                            }
                        }
                    });
                    
                    this.focusOnUSA();
                    this.hideLoading();
                    this.showStatus('Map initialized successfully', 'success');
                    console.log('Map initialized successfully');
                    return true;
                } catch (error) {
                    console.error('Error initializing map:', error);
                    this.showStatus('Error initializing map: ' + error.message, 'error');
                    
                    // Create a fallback for when Google Maps fails to load
                    const mapElement = document.getElementById('map');
                    if (mapElement) {
                        mapElement.innerHTML = `
                            <div style="height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; background-color: #f1f1f1;">
                                <h3>Map Loading Error</h3>
                                <p>We couldn't load the fire map. Please try refreshing the page.</p>
                                <button onclick="location.reload()" class="btn btn-primary">Refresh Page</button>
                            </div>
                        `;
                    }
                    
                    return false;
                }
            }
            setupEventListeners() {
                console.log('Setting up event listeners');
                
                // Sidebar toggle
                $('#toggle-sidebar').on('click', () => {
                    $('#sidebar').toggleClass('collapsed');
                    $('#toggle-sidebar').toggleClass('collapsed');
                    $('#status-panel').toggleClass('sidebar-collapsed');
                    $('#view-mode-toggle').toggleClass('sidebar-collapsed');
                    
                    if ($('#sidebar').hasClass('collapsed')) {
                        $('#toggle-sidebar i').removeClass('fa-chevron-left').addClass('fa-chevron-right');
                    } else {
                        $('#toggle-sidebar i').removeClass('fa-chevron-right').addClass('fa-chevron-left');
                    }
                });
                
                // Map controls
                $('#zoom-in').on('click', () => {
                    if (this.state.map) {
                        const currentZoom = this.state.map.getZoom();
                        this.state.map.setZoom(currentZoom + 1);
                    }
                });
                
                $('#zoom-out').on('click', () => {
                    if (this.state.map) {
                        const currentZoom = this.state.map.getZoom();
                        this.state.map.setZoom(currentZoom - 1);
                    }
                });
                
                $('#recenter').on('click', () => {
                    this.recenterMap();
                });
                
                $('#show-stats').on('click', () => {
                    this.showStatistics();
                });
                
                $('#close-stats').on('click', () => {
                    $('#stats-panel').hide();
                });
                
                // Filter controls
                $('#apply-filters').on('click', () => {
                    this.applyFilters();
                });
                
                $('#reset-filters').on('click', () => {
                    this.resetFilters();
                });
                
                // Region buttons
                $('.region-button').on('click', (e) => {
                    const $btn = $(e.currentTarget);
                    $('.region-button').removeClass('active');
                    $btn.addClass('active');
                    
                    const bounds = $btn.data('bounds');
                    if (bounds) {
                        const [west, south, east, north] = bounds.split(',').map(Number);
                        this.focusOnRegion(north, south, east, west);
                    }
                });
                
                // View mode toggle
                $('#usa-mode').on('click', () => {
                    this.setViewMode('usa');
                    $('#usa-mode').removeClass('btn-outline-primary').addClass('btn-primary');
                    $('#global-mode').removeClass('btn-primary').addClass('btn-outline-primary');
                    this.focusOnUSA();
                });
                
                $('#global-mode').on('click', () => {
                    this.setViewMode('global');
                    $('#global-mode').removeClass('btn-outline-primary').addClass('btn-primary');
                    $('#usa-mode').removeClass('btn-primary').addClass('btn-outline-primary');
                });
                
                // Pagination controls
                $('#prev-page').on('click', () => {
                    if (this.state.currentPage > 1) {
                        this.state.currentPage--;
                        this.updateMarkers();
                    }
                });
                
                $('#next-page').on('click', () => {
                    const totalPages = this.getTotalPages();
                    if (this.state.currentPage < totalPages) {
                        this.state.currentPage++;
                        this.updateMarkers();
                    }
                });
                
                // Display options
                $('#show-heatmap').on('change', () => {
                    this.toggleHeatmap($('#show-heatmap').is(':checked'));
                });
                
                $('#enable-clustering').on('change', () => {
                    this.updateMarkers();
                });
                
                $('#lazy-loading').on('change', () => {
                    this.state.lazyLoading = $('#lazy-loading').is(':checked');
                    if (!this.state.lazyLoading) {
                        if (this.state.viewMode === 'usa') {
                            this.loadUSAFireData();
                        } else {
                            this.loadWorldFireData();
                        }
                    }
                });
                
                $('#markers-per-page').on('change', () => {
                    this.state.markersPerPage = parseInt($('#markers-per-page').val());
                    this.state.currentPage = 1;
                    this.updateMarkers();
                });
                
                // Range slider displays
                $('#confidence-range').on('input', function() {
                    const value = parseInt($(this).val());
                    $('#confidence-min').text(value + '%');
                });
                
                $('#frp-range').on('input', function() {
                    const value = parseInt($(this).val());
                    if (value === 0) {
                        $('#frp-min').text('0');
                    } else {
                        $('#frp-min').text(value);
                    }
                });
                
                // Window resize handler
                window.addEventListener('resize', () => {
                    this.checkMobile();
                });
                
                // Mobile nav menu toggle
                $('.hamburger').on('click', function() {
                    $(this).toggleClass('active');
                    $('.nav-menu').toggleClass('active');
                });
            }
            setViewMode(mode) {
                this.state.viewMode = mode;
                if (mode === 'usa') {
                    this.focusOnUSA();
                    this.loadUSAFireData();
                }
            }
            focusOnUSA() {
                if (!this.state.map) return;
                
                const bounds = new google.maps.LatLngBounds(
                    new google.maps.LatLng(this.config.usBounds.south, this.config.usBounds.west),
                    new google.maps.LatLng(this.config.usBounds.north, this.config.usBounds.east)
                );
                this.state.map.fitBounds(bounds);
            }
            focusOnRegion(north, south, east, west) {
                if (!this.state.map) return;
                
                const bounds = new google.maps.LatLngBounds(
                    new google.maps.LatLng(south, west),
                    new google.maps.LatLng(north, east)
                );
                this.state.map.fitBounds(bounds);
            }
            async loadDataForViewport() {
                if (!this.state.map) return;
                
                const viewportString = JSON.stringify(this.state.viewport);
                if (this.state.loadingRegions.has(viewportString)) {
                    return;
                }
                
                const isUSAViewport = this.isViewportInUSA();
                if (this.state.viewMode === 'usa' && !isUSAViewport) {
                    return;
                }
                
                if (this.state.regionDataCache.has(viewportString)) {
                    console.log('Using cached data for viewport:', this.state.viewport);
                    return;
                }
                
                this.state.loadingRegions.add(viewportString);
                this.showRegionLoading();
                
                try {
                    let url = this.config.apiEndpoint;
                    const params = new URLSearchParams();
                    const source = this.state.activeFilters.source?.value || 'MODIS_NRT';
                    params.append('source', source);
                    params.append('area', 'world');
                    const days = this.state.activeFilters.days?.value || '1';
                    params.append('days', days);
                    
                    // Add viewport bounds for server-side filtering
                    params.append('north', this.state.viewport.north.toFixed(4));
                    params.append('south', this.state.viewport.south.toFixed(4));
                    params.append('east', this.state.viewport.east.toFixed(4));
                    params.append('west', this.state.viewport.west.toFixed(4));
                    
                    url = `${url}?${params.toString()}`;
                    console.log(`Fetching fire data for viewport:`, this.state.viewport);
                    const response = await this.fetchWithRetry(url);
                    
                    if (response.ok) {
                        try {
                            const data = await response.json();
                            if (Array.isArray(data)) {
                                console.log(`Received ${data.length} fire data points`);
                                this.state.regionDataCache.set(viewportString, data);
                                this.mergeFireData(data);
                                this.filterData();
                                this.updateMarkers();
                                this.showStatus(`Loaded ${data.length} fire data points for this area`, 'success');
                            }
                        } catch (error) {
                            console.error('Error processing viewport data:', error);
                            this.showStatus('Error processing data: ' + error.message, 'error');
                        }
                    } else {
                        const errorText = await response.text();
                        throw new Error(`Server responded with status ${response.status}: ${errorText}`);
                    }
                } catch (error) {
                    console.error('Error loading viewport data:', error);
                    this.showStatus('Error loading data: ' + error.message, 'error');
                } finally {
                    this.state.loadingRegions.delete(viewportString);
                    if (this.state.loadingRegions.size === 0) {
                        this.hideRegionLoading();
                    }
                }
            }
            mergeFireData(newData) {
                if (!Array.isArray(newData)) {
                    console.error('Invalid data format received:', newData);
                    return;
                }
                
                if (this.state.allFireData.length === 0) {
                    this.state.allFireData = [...newData];
                    return;
                }
                
                const existingIds = new Set();
                this.state.allFireData.forEach(point => {
                    const id = `${point.latitude},${point.longitude},${point.acq_date || ''},${point.acq_time || ''}`;
                    existingIds.add(id);
                });
                
                const uniqueNewData = newData.filter(point => {
                    const id = `${point.latitude},${point.longitude},${point.acq_date || ''},${point.acq_time || ''}`;
                    return !existingIds.has(id);
                });
                
                this.state.allFireData = [...this.state.allFireData, ...uniqueNewData];
                console.log(`Added ${uniqueNewData.length} new unique fire points`);
            }
            filterDataToViewport(data, viewport) {
                return data.filter(point => {
                    const lat = parseFloat(point.latitude);
                    const lng = parseFloat(point.longitude);
                    return (
                        lat >= viewport.south &&
                        lat <= viewport.north &&
                        lng >= viewport.west &&
                        lng <= viewport.east
                    );
                });
            }
            isViewportInUSA() {
                const viewport = this.state.viewport;
                const usBounds = this.config.usBounds;
                
                // Check if the viewport intersects with the USA bounds
                return !(
                    viewport.north < usBounds.south ||
                    viewport.south > usBounds.north ||
                    viewport.east < usBounds.west ||
                    viewport.west > usBounds.east
                );
            }
            async loadUSAFireData() {
                this.showStatus('Loading USA fire data...');
                
                try {
                    let url = this.config.apiEndpoint;
                    const params = new URLSearchParams();
                    const source = this.state.activeFilters.source?.value || 'MODIS_NRT';
                    params.append('source', source);
                    params.append('area', 'usa'); // Request USA data specifically
                    const days = this.state.activeFilters.days?.value || '1';
                    params.append('days', days);
                    
                    url = `${url}?${params.toString()}`;
                    console.log(`Fetching USA fire data: ${url}`);
                    
                    const response = await this.fetchWithRetry(url);
                    
                    if (response.ok) {
                        try {
                            const data = await response.json();
                            
                            if (Array.isArray(data)) {
                                console.log(`Received ${data.length} USA fire data points`);
                                this.processFireData(data);
                                this.showStatus(`Loaded ${data.length} USA fire data points`, 'success');
                            } else if (data.error) {
                                throw new Error(data.message || 'Unknown API error');
                            } else {
                                throw new Error('Unexpected response format from API');
                            }
                        } catch (error) {
                            console.error(`Error parsing API response: ${error.message}`);
                            throw error;
                        }
                    } else {
                        const errorText = await response.text();
                        throw new Error(`API responded with status ${response.status}: ${errorText}`);
                    }
                } catch (error) {
                    console.error(`Error loading USA fire data: ${error.message}`);
                    this.showStatus(`Error loading USA fire data: ${error.message}`, 'error');
                    
                    if (this.state.allFireData.length === 0) {
                        console.warn('Generating sample data as fallback');
                        this.generateSampleData();
                    }
                }
            }
            filterDataToUSA(data) {
                const usBounds = this.config.usBounds;
                const alaskaBounds = { west: -170, south: 51, east: -130, north: 71 };
                const hawaiiBounds = { west: -160, south: 18, east: -154, north: 23 };
                
                return data.filter(point => {
                    const lat = parseFloat(point.latitude);
                    const lng = parseFloat(point.longitude);
                    
                    const inContUS = (
                        lat >= usBounds.south &&
                        lat <= usBounds.north &&
                        lng >= usBounds.west &&
                        lng <= usBounds.east
                    );
                    
                    const inAlaska = (
                        lat >= alaskaBounds.south &&
                        lat <= alaskaBounds.north &&
                        lng >= alaskaBounds.west &&
                        lng <= alaskaBounds.east
                    );
                    
                    const inHawaii = (
                        lat >= hawaiiBounds.south &&
                        lat <= hawaiiBounds.north &&
                        lng >= hawaiiBounds.west &&
                        lng <= hawaiiBounds.east
                    );
                    
                    return inContUS || inAlaska || inHawaii;
                });
            }
            async loadWorldFireData() {
                if (!this.state.lazyLoading) {
                    this.showLoadingMessage('Loading global fire data...');
                }
                
                this.showStatus('Loading global fire data...');
                
                try {
                    let url = this.config.apiEndpoint;
                    const params = new URLSearchParams();
                    const source = this.state.activeFilters.source?.value || 'MODIS_NRT';
                    params.append('source', source);
                    params.append('area', 'world');
                    const days = this.state.activeFilters.days?.value || '1';
                    params.append('days', days);
                    
                    url = `${url}?${params.toString()}`;
                    console.log(`Fetching global fire data: ${url}`);
                    
                    const response = await this.fetchWithRetry(url);
                    
                    if (response.ok) {
                        try {
                            const data = await response.json();
                            
                            if (Array.isArray(data)) {
                                console.log(`Received ${data.length} global fire data points`);
                                this.processFireData(data);
                                this.showStatus(`Loaded ${data.length} global fire data points`, 'success');
                            } else if (data.error) {
                                throw new Error(data.message || 'Unknown API error');
                            } else {
                                throw new Error('Unexpected response format from API');
                            }
                        } catch (error) {
                            console.error(`Error parsing API response: ${error.message}`);
                            throw error;
                        }
                    } else {
                        const errorText = await response.text();
                        throw new Error(`API responded with status ${response.status}: ${errorText}`);
                    }
                } catch (error) {
                    console.error(`Error loading global fire data: ${error.message}`);
                    this.showStatus(`Error loading global fire data: ${error.message}`, 'error');
                    
                    if (this.state.allFireData.length === 0) {
                        console.warn('Generating sample data as fallback');
                        this.generateSampleData();
                    }
                } finally {
                    if (!this.state.lazyLoading) {
                        this.hideLoadingMessage();
                    }
                }
            }
            recenterMap() {
                if (!this.state.map) return;
                
                if (this.state.viewMode === 'usa') {
                    this.focusOnUSA();
                } else if (this.state.filteredData.length > 0) {
                    const bounds = new google.maps.LatLngBounds();
                    
                    this.state.filteredData.forEach(point => {
                        bounds.extend(new google.maps.LatLng(
                            parseFloat(point.latitude),
                            parseFloat(point.longitude)
                        ));
                    });
                    
                    this.state.map.fitBounds(bounds);
                } else {
                    this.state.map.setCenter(this.config.defaultCenter);
                    this.state.map.setZoom(this.config.defaultZoom);
                }
            }
            applyFilters() {
                this.updateActiveFilters();
                
                if (this.state.activeFilters.source || this.state.activeFilters.days) {
                    // These filters require new data from the server
                    this.state.regionDataCache.clear();
                    
                    if (this.state.viewMode === 'usa') {
                        this.loadUSAFireData();
                    } else if (this.state.lazyLoading) {
                        this.loadDataForViewport();
                    } else {
                        this.loadWorldFireData();
                    }
                } else {
                    // These filters can be applied client-side
                    this.filterData();
                    this.updateMarkers();
                }
            }
            resetFilters() {
                $('#data-source').val('MODIS_NRT');
                $('#days-range').val('1');
                $('#confidence-range').val(0);
                $('#frp-range').val(0);
                $('#confidence-min').text('0%');
                $('#frp-min').text('0');
                $('#enable-clustering').prop('checked', true);
                $('#show-heatmap').prop('checked', false);
                $('#markers-per-page').val('1000');
                
                this.state.markersPerPage = 1000;
                this.state.currentPage = 1;
                this.state.activeFilters = {};
                
                $('#active-filters').empty();
                this.state.regionDataCache.clear();
                
                if (this.state.viewMode === 'usa') {
                    this.loadUSAFireData();
                } else {
                    this.loadWorldFireData();
                }
            }
            updateActiveFilters() {
                this.state.activeFilters = {};
                $('#active-filters').empty();
                
                // Source filter
                const source = $('#data-source').val();
                const sourceText = $('#data-source option:selected').text();
                if (source !== 'MODIS_NRT') {
                    this.state.activeFilters.source = { value: source, label: sourceText };
                    this.addFilterTag('source', sourceText, () => {
                        $('#data-source').val('MODIS_NRT');
                        this.removeFilterTag('source');
                        delete this.state.activeFilters.source;
                    });
                }
                
                // Days filter
                const days = $('#days-range').val();
                const daysText = $('#days-range option:selected').text();
                if (days !== '1') {
                    this.state.activeFilters.days = { value: days, label: daysText };
                    this.addFilterTag('days', daysText, () => {
                        $('#days-range').val('1');
                        this.removeFilterTag('days');
                        delete this.state.activeFilters.days;
                    });
                }
                
                // Confidence filter
                const confidence = parseInt($('#confidence-range').val());
                if (confidence > 0) {
                    this.state.activeFilters.confidence = { value: confidence, label: `Confidence ≥ ${confidence}%` };
                    this.addFilterTag('confidence', `Confidence ≥ ${confidence}%`, () => {
                        $('#confidence-range').val(0);
                        $('#confidence-min').text('0%');
                        this.removeFilterTag('confidence');
                        delete this.state.activeFilters.confidence;
                    });
                }
                
                // Fire Radiative Power (FRP) filter
                const frp = parseInt($('#frp-range').val());
                if (frp > 0) {
                    this.state.activeFilters.frp = { value: frp, label: `FRP ≥ ${frp} MW` };
                    this.addFilterTag('frp', `FRP ≥ ${frp} MW`, () => {
                        $('#frp-range').val(0);
                        $('#frp-min').text('0');
                        this.removeFilterTag('frp');
                        delete this.state.activeFilters.frp;
                    });
                }
            }
            addFilterTag(id, text, removeCallback) {
                const tag = $(`<span class="filter-tag" data-filter-id="${id}">${text} <span class="remove-filter">×</span></span>`);
                tag.find('.remove-filter').on('click', removeCallback);
                $('#active-filters').append(tag);
            }
            removeFilterTag(id) {
                $(`.filter-tag[data-filter-id="${id}"]`).remove();
            }
            processFireData(data) {
                if (!Array.isArray(data)) {
                    console.error('Invalid data format received:', data);
                    this.state.allFireData = [];
                    this.state.totalFirePoints = 0;
                    this.filterData();
                    this.updateMarkers();
                    return;
                }
                
                this.state.allFireData = data;
                this.state.totalFirePoints = data.length;
                this.filterData();
                this.updateMarkers();
            }
            filterData() {
                let filtered = [...this.state.allFireData];
                
                // Apply confidence filter
                if (this.state.activeFilters.confidence) {
                    const minConfidence = parseInt(this.state.activeFilters.confidence.value);
                    filtered = filtered.filter(point => {
                        const confidence = parseInt(point.confidence) || 0;
                        return confidence >= minConfidence;
                    });
                }
                
                // Apply FRP filter
                if (this.state.activeFilters.frp) {
                    const minFrp = parseInt(this.state.activeFilters.frp.value);
                    filtered = filtered.filter(point => {
                        const frp = parseFloat(point.frp) || 0;
                        return frp >= minFrp;
                    });
                }
                
                this.state.filteredData = filtered;
                this.updatePaginationInfo();
            }
            updateMarkers() {
                if (!this.state.map) return;
                
                this.clearMarkers();
                
                if (this.state.currentPage > this.getTotalPages()) {
                    this.state.currentPage = 1;
                }
                
                this.updatePaginationInfo();
                
                if (this.state.filteredData.length === 0) {
                    this.showStatus('No fire data points match your filters.', 'warning');
                    return;
                }
                
                // Determine which data to display based on pagination
                let displayData;
                if (this.state.markersPerPage === Number.MAX_SAFE_INTEGER) {
                    displayData = this.state.filteredData;
                } else {
                    const startIndex = (this.state.currentPage - 1) * this.state.markersPerPage;
                    const endIndex = startIndex + this.state.markersPerPage;
                    displayData = this.state.filteredData.slice(startIndex, endIndex);
                }
                
                const heatmapData = [];
                const markers = displayData.map(fire => {
                    if (!fire.latitude || !fire.longitude) return null;
                    
                    const lat = parseFloat(fire.latitude);
                    const lng = parseFloat(fire.longitude);
                    
                    if (isNaN(lat) || isNaN(lng)) return null;
                    
                    // Add data for heatmap
                    heatmapData.push({
                        location: new google.maps.LatLng(lat, lng),
                        weight: parseFloat(fire.frp) || 1
                    });
                    
                    // Create marker
                    const marker = new google.maps.Marker({
                        position: { lat, lng },
                        map: this.state.map,
                        icon: this.createFireIcon(fire),
                        title: `Fire at ${lat}, ${lng}`
                    });
                    
                    // Add click handler
                    marker.addListener('click', () => {
                        this.showFireInfo(marker, fire);
                    });
                    
                    // Add hover effect
                    this.addMarkerHoverEffect(marker, fire);
                    
                    return marker;
                }).filter(marker => marker !== null);
                
                this.state.markers = markers;
                
                // Set up clustering if enabled
                if ($('#enable-clustering').is(':checked')) {
                    this.setupMarkerClusterer();
                }
                
                // Set up heatmap if enabled
                if ($('#show-heatmap').is(':checked')) {
                    this.setupHeatmap(heatmapData);
                }
                
                this.showStatus(`Showing ${markers.length} of ${this.state.filteredData.length} fire points`, 'success');
            }
            setupMarkerClusterer() {
                try {
                    if (!window.MarkerClusterer) {
                        console.error('MarkerClusterer is not defined. Skipping clustering');
                        return;
                    }
                    
                    console.log('Setting up marker clustering');
                    
                    if (this.state.markerClusterer) {
                        this.state.markerClusterer.clearMarkers();
                    }
                    
                    const renderer = {
                        render: ({ count, position }) => {
                            return new google.maps.Marker({
                                position,
                                label: { text: String(count), color: "white", fontSize: "10px" },
                                icon: {
                                    path: google.maps.SymbolPath.CIRCLE,
                                    fillColor: "#ff4500",
                                    fillOpacity: 0.7,
                                    strokeColor: "#ffffff",
                                    strokeWeight: 1,
                                    scale: Math.min(count / 5 + 10, 25)
                                },
                                zIndex: 1000
                            });
                        }
                    };
                    
                    this.state.markerClusterer = new MarkerClusterer({
                        map: this.state.map,
                        markers: this.state.markers,
                        renderer: renderer
                    });
                    
                    console.log('Marker clustering set up successfully');
                } catch (error) {
                    console.error('Error setting up marker clustering:', error);
                }
            }
            setupHeatmap(heatmapData) {
                if (!this.state.map || !google.maps.visualization) {
                    console.error('Google Maps visualization library not loaded. Skipping heatmap.');
                    return;
                }
                
                if (this.state.heatmap) {
                    this.state.heatmap.setMap(null);
                }
                
                this.state.heatmap = new google.maps.visualization.HeatmapLayer({
                    data: heatmapData,
                    map: this.state.map,
                    radius: 20,
                    opacity: 0.7,
                    gradient: [
                        'rgba(255, 255, 0, 0)',
                        'rgba(255, 255, 0, 1)',
                        'rgba(255, 204, 0, 1)',
                        'rgba(255, 153, 0, 1)',
                        'rgba(255, 102, 0, 1)',
                        'rgba(255, 51, 0, 1)',
                        'rgba(255, 0, 0, 1)'
                    ]
                });
            }
            toggleHeatmap(visible) {
                if (!this.state.map || !google.maps.visualization) {
                    console.error('Google Maps visualization library not loaded. Cannot toggle heatmap.');
                    return;
                }
                
                if (visible) {
                    const heatmapData = this.state.filteredData.map(fire => {
                        return {
                            location: new google.maps.LatLng(
                                parseFloat(fire.latitude),
                                parseFloat(fire.longitude)
                            ),
                            weight: parseFloat(fire.frp) || 1
                        };
                    });
                    this.setupHeatmap(heatmapData);
                } else if (this.state.heatmap) {
                    this.state.heatmap.setMap(null);
                    this.state.heatmap = null;
                }
            }
            clearMarkers() {
                if (!this.state.map) return;
                
                this.state.markers.forEach(marker => marker.setMap(null));
                this.state.markers = [];
                
                if (this.state.markerClusterer) {
                    this.state.markerClusterer.clearMarkers();
                }
                
                if (this.state.heatmap) {
                    this.state.heatmap.setMap(null);
                }
                
                if (this.state.infoWindow) {
                    this.state.infoWindow.close();
                }
            }
            createFireIcon(fire) {
                const confidence = parseInt(fire.confidence) || 50;
                const frp = parseFloat(fire.frp) || 10;
                
                const color = this.getFireColor(confidence);
                const size = this.getFireSize(frp);
                
                return {
                    path: google.maps.SymbolPath.CIRCLE,
                    fillColor: color,
                    fillOpacity: 0.7,
                    strokeColor: '#FFFFFF',
                    strokeWeight: 1,
                    scale: size
                };
            }
            getFireColor(confidence) {
                if (confidence >= 80) return '#FF0000';
                if (confidence >= 60) return '#FF4500';
                if (confidence >= 30) return '#FFA500';
                return '#FFCC00';
            }
            getFireSize(frp) {
                if (frp > 50) return 14;
                if (frp > 20) return 12;
                if (frp > 10) return 10;
                return 8;
            }
            showFireInfo(marker, fire) {
                if (!this.state.infoWindow) return;
                
                let dateTimeInfo = '';
                if (fire.acq_date) {
                    dateTimeInfo += `<p><strong>Detection Date:</strong> ${fire.acq_date}</p>`;
                    
                    if (fire.acq_time) {
                        const timeStr = fire.acq_time.toString().padStart(4, '0');
                        const hours = timeStr.substring(0, 2);
                        const minutes = timeStr.substring(2, 4);
                        dateTimeInfo += `<p><strong>Detection Time:</strong> ${hours}:${minutes} UTC</p>`;
                    }
                }
                
                const content = `
                    <div style="padding: 8px; max-width: 300px;">
                        <h5 style="margin-top: 0; color: #333;">Fire Information</h5>
                        <p><strong>Location:</strong> ${fire.latitude}, ${fire.longitude}</p>
                        <p><strong>Confidence:</strong> ${fire.confidence || 'Unknown'}%</p>
                        <p><strong>Fire Power:</strong> ${fire.frp || 'Unknown'} MW</p>
                        ${dateTimeInfo}
                        <p style="margin-top: 8px; font-size: 12px; color: #666;">
                            <i class="fas fa-info-circle"></i> Data source: ${$('#data-source option:selected').text()}
                        </p>
                    </div>
                `;
                
                this.state.infoWindow.setContent(content);
                this.state.infoWindow.open(this.state.map, marker);
            }
            addMarkerHoverEffect(marker, fire) {
                const tooltip = document.getElementById('custom-tooltip');
                if (!tooltip) {
                    console.error('Custom tooltip element not found');
                    return;
                }
                
                marker.addListener('mouseover', function(event) {
                    const point = event.pixel;
                    tooltip.style.left = (point.x + 15) + 'px';
                    tooltip.style.top = (point.y - 15) + 'px';
                    tooltip.innerHTML = `
                        Confidence: ${fire.confidence || 'Unknown'}%<br>
                        Fire Power: ${fire.frp || 'Unknown'} MW
                    `;
                    tooltip.style.display = 'block';
                });
                
                marker.addListener('mouseout', function() {
                    tooltip.style.display = 'none';
                });
                
                marker.addListener('mousemove', function(event) {
                    const point = event.pixel;
                    tooltip.style.left = (point.x + 15) + 'px';
                    tooltip.style.top = (point.y - 15) + 'px';
                });
            }
            generateSampleData() {
                this.showStatus('Using sample data as fallback', 'warning');
                
                const center = this.config.defaultCenter;
                const sampleData = [];
                
                for (let i = 0; i < 50; i++) {
                    const latOffset = (Math.random() - 0.5) * 20;
                    const lngOffset = (Math.random() - 0.5) * 50;
                    const confidence = Math.floor(Math.random() * 100);
                    const frp = Math.random() * 100;
                    
                    sampleData.push({
                        latitude: center.lat + latOffset,
                        longitude: center.lng + lngOffset,
                        confidence: confidence,
                        frp: frp,
                        acq_date: '2025-05-12',
                        acq_time: '1200'
                    });
                }
                
                this.processFireData(sampleData);
            }
            showLoading(message = 'Loading...') {
                const loadingOverlay = document.getElementById('loading-overlay');
                if (loadingOverlay) {
                    loadingOverlay.style.display = 'flex';
                    const loadingMessage = document.getElementById('loading-message');
                    if (loadingMessage) {
                        loadingMessage.textContent = message;
                    }
                }
            }
            hideLoading() {
                const loadingOverlay = document.getElementById('loading-overlay');
                if (loadingOverlay) {
                    loadingOverlay.style.display = 'none';
                }
            }
            showRegionLoading() {
                const regionLoading = document.getElementById('region-loading');
                if (regionLoading) {
                    regionLoading.style.display = 'block';
                }
            }
            hideRegionLoading() {
                const regionLoading = document.getElementById('region-loading');
                if (regionLoading) {
                    regionLoading.style.display = 'none';
                }
            }
            showLoadingMessage(message) {
                const loadingMessage = document.getElementById('loading-data-message');
                if (loadingMessage) {
                    loadingMessage.innerHTML = `<span class="loading-data-spinner"></span> ${message}`;
                    loadingMessage.style.display = 'block';
                }
            }
            hideLoadingMessage() {
                const loadingMessage = document.getElementById('loading-data-message');
                if (loadingMessage) {
                    loadingMessage.style.display = 'none';
                }
            }
            showStatus(message, type = 'info') {
                const statusPanel = document.getElementById('status-panel');
                if (!statusPanel) return;
                
                statusPanel.textContent = message;
                statusPanel.className = '';
                statusPanel.classList.add('status-panel');
                
                if ($('#sidebar').hasClass('collapsed')) {
                    statusPanel.classList.add('sidebar-collapsed');
                }
                
                switch (type) {
                    case 'success':
                        statusPanel.style.backgroundColor = '#d4edda';
                        statusPanel.style.color = '#155724';
                        break;
                    case 'error':
                        statusPanel.style.backgroundColor = '#f8d7da';
                        statusPanel.style.color = '#721c24';
                        break;
                    case 'warning':
                        statusPanel.style.backgroundColor = '#fff3cd';
                        statusPanel.style.color = '#856404';
                        break;
                    default:
                        statusPanel.style.backgroundColor = '#d1ecf1';
                        statusPanel.style.color = '#0c5460';
                }
                
                statusPanel.style.display = 'block';
                
                if (type !== 'error') {
                    setTimeout(() => {
                        statusPanel.style.display = 'none';
                    }, 5000);
                }
            }
            updatePaginationInfo() {
                const totalPages = this.getTotalPages();
                $('#current-page').text(this.state.currentPage);
                $('#total-pages').text(totalPages);
                $('#prev-page').prop('disabled', this.state.currentPage <= 1);
                $('#next-page').prop('disabled', this.state.currentPage >= totalPages);
                
                if (totalPages <= 1) {
                    $('.pagination-container').hide();
                } else {
                    $('.pagination-container').show();
                }
            }
            getTotalPages() {
                return Math.ceil(this.state.filteredData.length / this.state.markersPerPage);
            }
            showStatistics() {
                if (this.state.filteredData.length === 0) {
                    this.showStatus('No data available for statistics', 'warning');
                    return;
                }
                
                $('#stats-panel').show();
                
                const totalFires = this.state.filteredData.length;
                const confidenceLevels = { high: 0, medium: 0, low: 0, veryLow: 0 };
                const frpLevels = { extreme: 0, high: 0, medium: 0, low: 0 };
                const dateMap = new Map();
                
                this.state.filteredData.forEach(fire => {
                    // Process confidence levels
                    const confidence = parseInt(fire.confidence) || 0;
                    if (confidence >= 80) confidenceLevels.high++;
                    else if (confidence >= 60) confidenceLevels.medium++;
                    else if (confidence >= 30) confidenceLevels.low++;
                    else confidenceLevels.veryLow++;
                    
                    // Process FRP levels
                    const frp = parseFloat(fire.frp) || 0;
                    if (frp > 50) frpLevels.extreme++;
                    else if (frp > 20) frpLevels.high++;
                    else if (frp > 10) frpLevels.medium++;
                    else frpLevels.low++;
                    
                    // Process dates
                    const date = fire.acq_date || 'Unknown';
                    if (dateMap.has(date)) {
                        dateMap.set(date, dateMap.get(date) + 1);
                    } else {
                        dateMap.set(date, 1);
                    }
                });
                
                // Sort dates by count (most fires first)
                const sortedDates = [...dateMap.entries()].sort((a, b) => b[1] - a[1]).slice(0, 5);
                
                // Build statistics HTML
                let statsHtml = `
                    <div class="mb-3">
                        <strong>Total Fire Points:</strong> ${totalFires}<br>
                        <strong>Data Source:</strong> ${$('#data-source option:selected').text()}<br>
                        <strong>Time Range:</strong> ${$('#days-range option:selected').text()}<br>
                        <strong>Region:</strong> ${this.state.viewMode === 'usa' ? 'USA' : 'Global'}
                    </div>
                    <div class="mb-3">
                        <strong>Confidence Levels:</strong><br>
                        High (80-100%): ${confidenceLevels.high} (${Math.round(confidenceLevels.high/totalFires*100)}%)<br>
                        Medium (60-79%): ${confidenceLevels.medium} (${Math.round(confidenceLevels.medium/totalFires*100)}%)<br>
                        Low (30-59%): ${confidenceLevels.low} (${Math.round(confidenceLevels.low/totalFires*100)}%)<br>
                        Very Low (0-29%): ${confidenceLevels.veryLow} (${Math.round(confidenceLevels.veryLow/totalFires*100)}%)
                    </div>
                    <div class="mb-3">
                        <strong>Fire Intensity (FRP):</strong><br>
                        Extreme (>50 MW): ${frpLevels.extreme} (${Math.round(frpLevels.extreme/totalFires*100)}%)<br>
                        High (20-50 MW): ${frpLevels.high} (${Math.round(frpLevels.high/totalFires*100)}%)<br>
                        Medium (10-20 MW): ${frpLevels.medium} (${Math.round(frpLevels.medium/totalFires*100)}%)<br>
                        Low (<10 MW): ${frpLevels.low} (${Math.round(frpLevels.low/totalFires*100)}%)
                    </div>
                `;
                
                // Add top detection dates if available
                if (sortedDates.length > 0 && sortedDates[0][0] !== 'Unknown') {
                    statsHtml += `
                        <div>
                            <strong>Top Detection Dates:</strong><br>
                    `;
                    sortedDates.forEach(([date, count]) => {
                        statsHtml += `${date}: ${count} fires (${Math.round(count/totalFires*100)}%)<br>`;
                    });
                    statsHtml += `</div>`;
                }
                
                $('#stats-content').html(statsHtml);
            }
            async fetchWithRetry(url, retries = 0) {
                try {
                    console.log(`Fetch attempt ${retries + 1}/${this.config.maxFetchRetries + 1}: ${url}`);
                    
                    const response = await fetch(url, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                            'Cache-Control': 'no-cache'
                        },
                        cache: 'no-cache'
                    });
                    
                    console.log(`Response status: ${response.status} ${response.statusText}`);
                    return response;
                } catch (error) {
                    console.error(`Fetch error: ${error.message}`);
                    
                    // Retry with exponential backoff if we haven't exceeded max retries
                    if (retries < this.config.maxFetchRetries) {
                        console.log(`Retrying... (${retries + 1}/${this.config.maxFetchRetries})`);
                        const backoff = Math.pow(2, retries) * 1000; // Exponential backoff
                        await new Promise(resolve => setTimeout(resolve, backoff));
                        return this.fetchWithRetry(url, retries + 1);
                    }
                    
                    throw error;
                }
            }
        }
        
        $(document).ready(function() {
            // Initialize the year display in the footer
            const yearSpan = document.getElementById('year');
            if (yearSpan) {
                yearSpan.textContent = new Date().getFullYear();
            }
            
            // Initialize the fire map application
            window.fireMap = new FireMap();
            
            // Setup mobile navigation
            const hamburger = document.querySelector('.hamburger');
            const navMenu = document.querySelector('.nav-menu');
            
            if (hamburger && navMenu) {
                hamburger.addEventListener('click', function() {
                    const isExpanded = this.getAttribute('aria-expanded') === 'true';
                    this.classList.toggle('active');
                    navMenu.classList.toggle('active');
                    this.setAttribute('aria-expanded', !isExpanded);
                });
                
                // Close mobile menu when clicking a link
                document.querySelectorAll('.nav-menu a').forEach(link => {
                    link.addEventListener('click', function() {
                        hamburger.classList.remove('active');
                        navMenu.classList.remove('active');
                        hamburger.setAttribute('aria-expanded', 'false');
                    });
                });
            }
            
            // Smooth scroll for anchor links
            document.querySelectorAll('a[href^="#"]:not([href="#"])').forEach(anchor => {
                anchor.addEventListener('click', function(e) {
                    const targetId = this.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    
                    if (targetElement) {
                        e.preventDefault();
                        targetElement.scrollIntoView({
                            behavior: 'smooth'
                        });
                    }
                });
            });
        });
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD9MXRpmeXMKlezIOs3lPAjn0C5yLeTNUk&libraries=visualization,drawing,geometry&callback=initMap"></script>
    <script>
        // Initialize Google Maps callback
        function initMap() {
            console.log("Google Maps API loaded successfully");
            // The FireMap class will handle the initialization
        }
    </script>
</body>
</html>
