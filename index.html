<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eye on the Fire - Live US Wildfire Map | Fires Near Me Tracker</title>
    <meta name="description" content="Track wildfires near you with Eye on the Fire's live US interactive map. Get real-time updates, safety guides, and emergency resources.">
    <meta name="keywords" content="wildfire map, fires near me, US wildfire tracker, real-time fire updates, wildfire safety">
    <meta property="og:title" content="Eye on the Fire - Live US Wildfire Map">
    <meta property="og:description" content="Track wildfires in real-time with our interactive US map. Stay informed and safe with updates and resources.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://eyeonthefire.com/">
    <meta property="og:image" content="https://eyeonthefire.com/images/hero-bg.jpg">
    <link rel="canonical" href="https://eyeonthefire.com/">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <!-- Favicon Links -->
    <link rel="shortcut icon" href="/favicon/favicon.ico" type="image/x-icon">
    <link rel="icon" type="image/png" href="/favicon/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/favicon/favicon-16x16.png" sizes="16x16">
    <link rel="apple-touch-icon" href="/favicon/apple-touch-icon.png" sizes="180x180">
    <link rel="manifest" href="/favicon/site.webmanifest">
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-T8RE6KDBEW"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-T8RE6KDBEW');
    </script>
    <style>
        :root {
            --primary-color: #ff4500;
            --secondary-color: #ff7f50;
            --dark-color: #333;
            --light-color: #f8f9fa;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --success-color: #28a745;
            --info-color: #17a2b8;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        body {
            font-family: 'Open Sans', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        
        h1, h2, h3, h4, h5, h6, .logo-text-footer {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
        }
        
        .navbar {
            background-color: rgba(255, 255, 255, 0.95);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1030;
            transition: all 0.3s ease;
            padding: 0;
        }
        
        .navbar-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
            height: 70px;
        }
        
        .navbar.scrolled {
            background-color: rgba(255, 255, 255, 0.98);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .logo-link {
            text-decoration: none;
            color: #333;
            display: flex;
            align-items: center;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
        }
        
        .logo-container span {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 1.25rem;
            margin-left: 10px;
            color: var(--dark-color);
        }
        
        #navbar-logo {
            height: 40px;
            width: auto;
        }
        
        .nav-menu {
            display: flex;
            align-items: center;
        }
        
        .main-menu {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        
        .main-menu li {
            position: relative;
            margin: 0 5px;
        }
        
        .main-menu a {
            display: block;
            padding: 10px 15px;
            color: #333;
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
            transition: color 0.3s ease;
        }
        
        .main-menu a:hover {
            color: var(--primary-color);
        }
        
        .main-menu a.active {
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .hamburger {
            display: none;
            background: none;
            border: none;
            cursor: pointer;
            padding: 10px;
            z-index: 1031;
        }
        
        .line {
            display: block;
            width: 25px;
            height: 3px;
            margin: 5px auto;
            background-color: #333;
            transition: all 0.3s ease-in-out;
        }
        
        /* Hero Section */
        .hero {
            height: 70vh;
            min-height: 500px;
            background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('/images/wildfire-hero.jpg') no-repeat center center/cover;
            display: flex;
            align-items: center;
            text-align: center;
            color: white;
            margin-top: 70px;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at bottom, rgba(255, 69, 0, 0.3) 0%, transparent 70%);
            z-index: 1;
            animation: pulse 4s infinite alternate;
        }

        @keyframes pulse {
            0% { opacity: 0.3; }
            100% { opacity: 0.7; }
        }
        
        .hero-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 2;
        }
        
        .hero h1 {
            font-size: 2.8rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
        }
        
        .hero p {
            font-size: 1.2rem;
            margin-bottom: 30px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
        }
        
        .cta-button {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
            padding: 12px 25px;
            border-radius: 50px;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 69, 0, 0.3);
            border: none;
            font-size: 1rem;
        }
        
        .cta-button:hover {
            background-color: #e03e00;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 69, 0, 0.4);
        }
        
        /* Content Sections */
        .content-section {
            padding: 60px 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        .section-title {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
            position: relative;
            padding-bottom: 15px;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
        }
        
        .section-intro {
            text-align: center;
            max-width: 800px;
            margin: 0 auto 40px;
            font-size: 1.1rem;
            color: #555;
        }
        
        .section-divider {
            border: 0;
            height: 1px;
            background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0));
            margin: 0;
        }
        
        /* Map Section */
        .map-usage-guide {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            border-left: 4px solid var(--primary-color);
        }
        
        .map-usage-guide h4 {
            margin-top: 0;
            color: #333;
            display: flex;
            align-items: center;
        }
        
        .map-usage-guide h4 i {
            margin-right: 10px;
            color: var(--primary-color);
        }
        
        .map-usage-guide ul {
            list-style: none;
            padding: 0;
            margin: 15px 0 0;
        }
        
        .map-usage-guide li {
            display: flex;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        
        .map-usage-guide li i {
            color: var(--primary-color);
            margin-right: 10px;
            margin-top: 4px;
            flex-shrink: 0;
        }
        
        .map-wrapper {
            position: relative;
            width: 100%;
            margin: 30px 0;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
        }
        
        .map-wrapper #map-container {
            position: relative;
            height: 600px;
            width: 100%;
            overflow: hidden;
        }
        
        .map-wrapper #map {
            height: 100%;
            width: 100%;
        }
        
        .map-wrapper #sidebar {
            position: absolute;
            top: 0;
            left: 0;
            width: 300px;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.2);
            overflow-y: auto;
            z-index: 1000;
            transition: transform 0.3s ease;
        }
        
        .map-wrapper #sidebar.collapsed {
            transform: translateX(-300px);
        }
        
        .map-wrapper #toggle-sidebar {
            position: absolute;
            left: 300px;
            top: 10px;
            background: white;
            padding: 8px 12px;
            border-radius: 0 4px 4px 0;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            z-index: 1000;
            transition: left 0.3s ease;
        }
        
        .map-wrapper #toggle-sidebar.collapsed {
            left: 0;
        }
        
        .map-wrapper .sidebar-content {
            padding: 15px;
            font-size: 0.9rem;
        }
        
        .map-wrapper .sidebar-header {
            padding: 15px;
            border-bottom: 1px solid #ddd;
            background-color: #f8f9fa;
        }
        
        .map-wrapper .sidebar-section {
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }
        
        .map-wrapper .sidebar-section h5 {
            margin-bottom: 10px;
            color: #333;
            font-size: 1rem;
        }
        
        .map-wrapper .form-group {
            margin-bottom: 12px;
        }
        
        .map-wrapper label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }
        
        .map-wrapper .map-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 900;
        }
        
        .map-wrapper .map-control-btn {
            background: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 4px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            margin-bottom: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: #555;
            transition: all 0.2s ease;
        }
        
        .map-wrapper .map-control-btn:hover {
            background: #f0f0f0;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
        }
        
        .map-wrapper #legend {
            position: absolute;
            bottom: 30px;
            right: 10px;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            z-index: 900;
            max-width: 240px;
            font-size: 11px;
        }
        
        .map-wrapper .legend-item {
            display: flex;
            align-items: center;
            margin: 4px 0;
        }
        
        .map-wrapper .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 8px;
            border: 1px solid #ddd;
        }
        
        .map-wrapper #status-panel {
            position: absolute;
            bottom: 30px;
            left: 310px;
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            z-index: 900;
            max-width: 400px;
            font-size: 14px;
            display: none;
            transition: left 0.3s ease;
        }
        
        .map-wrapper #status-panel.sidebar-collapsed {
            left: 10px;
        }
        
        .map-wrapper .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .map-wrapper .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        .map-wrapper #custom-tooltip {
            position: absolute;
            display: none;
            background: white;
            padding: 8px 12px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            font-size: 12px;
            pointer-events: none;
            z-index: 9999;
            border-left: 3px solid var(--primary-color);
        }
        
        .map-wrapper .region-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            display: none;
            z-index: 1001;
            text-align: center;
            max-width: 80%;
        }
        
        .map-wrapper .region-loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
            vertical-align: middle;
        }
        
        .map-wrapper .loading-data-message {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 8px 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            display: none;
            z-index: 1001;
            text-align: center;
            white-space: nowrap;
        }
        
        .map-wrapper .loading-data-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
            vertical-align: middle;
        }
        
        .map-wrapper #view-mode-toggle {
            position: absolute;
            bottom: 70px;
            left: 310px;
            z-index: 900;
            transition: left 0.3s ease;
        }
        
        .map-wrapper #view-mode-toggle.sidebar-collapsed {
            left: 10px;
        }
        
        .map-wrapper .filter-tag {
            display: inline-block;
            background: #e9f5ff;
            color: #0066cc;
            padding: 3px 8px;
            border-radius: 15px;
            margin: 0 5px 5px 0;
            font-size: 0.8rem;
        }
        
        .map-wrapper .filter-tag .remove-filter {
            margin-left: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .map-wrapper .region-button {
            display: inline-block;
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 0 4px 4px 0;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s ease;
        }
        
        .map-wrapper .region-button:hover {
            background-color: #f0f0f0;
        }
        
        .map-wrapper .region-button.active {
            background-color: var(--primary-color);
            color: white;
            border-color: #e03e00;
        }
        
        .map-wrapper .region-buttons {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }
        
        .map-wrapper #stats-panel {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            width: 80%;
            max-width: 500px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 1100;
            display: none;
        }
        
        .map-wrapper .stats-title {
            padding: 15px;
            border-bottom: 1px solid #ddd;
            font-weight: bold;
            font-size: 1.1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .map-wrapper #stats-content {
            padding: 15px;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .map-wrapper .color-scale {
            height: 10px;
            display: flex;
            margin-top: 4px;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .map-wrapper .color-scale div {
            flex: 1;
            height: 100%;
        }
        
        /* Prevention Section */
        .prevention-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }
        
        .prevention-item {
            background-color: white;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .prevention-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        
        .prevention-item i {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 20px;
        }
        
        .prevention-item h3 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .prevention-item p {
            color: #666;
        }
        
        /* Community Section */
        .cta-banner {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .cta-banner p {
            margin: 0;
            font-size: 1.1rem;
        }
        
        .cta-banner a {
            color: white;
            font-weight: 600;
            text-decoration: underline;
        }
        
        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .gallery-item {
            border-radius: 8px;
            overflow: hidden;
            height: 220px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        
        .gallery-item:hover img {
            transform: scale(1.05);
        }
        
        /* Footer */
        .site-footer {
            background-color: #222;
            color: white;
            padding: 60px 15px 20px;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .footer-section h3 {
            color: white;
            margin-bottom: 20px;
            position: relative;
            padding-bottom: 10px;
        }
        
        .footer-section h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 2px;
            background-color: var(--primary-color);
        }
        
        .footer-section p {
            color: #ccc;
        }
        
        .footer-section ul {
            list-style: none;
            padding: 0;
        }
        
        .footer-section ul li {
            margin-bottom: 10px;
        }
        
        .footer-section ul li a {
            color: #ccc;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .footer-section ul li a:hover {
            color: var(--primary-color);
        }
        
        .social-icons {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        
        .social-icons a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s ease;
        }
        
        .social-icons a:hover {
            background-color: var(--primary-color);
            transform: translateY(-3px);
        }
        
        .footer-bottom {
            text-align: center;
            padding-top: 30px;
            margin-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #999;
            font-size: 0.9rem;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .footer-bottom a {
            color: #ccc;
            text-decoration: none;
        }
        
        .footer-bottom a:hover {
            color: var(--primary-color);
        }
        
        /* Data Source Note */
        .data-source-note {
            margin-top: 15px;
            text-align: center;
            font-size: 0.85rem;
            color: #777;
        }
        
        /* Animations */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        /* Mobile Responsiveness */
        @media (max-width: 991px) {
            .hero h1 {
                font-size: 2.3rem;
            }
            
            .hero p {
                font-size: 1.1rem;
            }
            
            .prevention-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .hamburger {
                display: block;
            }
            
            .nav-menu {
                position: fixed;
                top: 70px;
                right: -100%;
                width: 270px;
                height: calc(100vh - 70px);
                background-color: white;
                flex-direction: column;
                align-items: flex-start;
                box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
                transition: 0.4s;
                z-index: 1029;
                overflow-y: auto;
                padding: 20px 0;
            }
            
            .nav-menu.active {
                right: 0;
            }
            
            .main-menu {
                flex-direction: column;
                width: 100%;
            }
            
            .main-menu li {
                margin: 0;
                width: 100%;
            }
            
            .main-menu a {
                padding: 12px 20px;
                border-bottom: 1px solid #f1f1f1;
            }
            
            .hamburger.active .line1 {
                transform: rotate(-45deg) translate(-5px, 6px);
            }
            
            .hamburger.active .line2 {
                opacity: 0;
            }
            
            .hamburger.active .line3 {
                transform: rotate(45deg) translate(-5px, -6px);
            }
            
            .map-wrapper #map-container {
                height: 500px;
            }
            
            .map-wrapper #sidebar {
                width: 270px;
            }
            
            .map-wrapper #toggle-sidebar {
                left: 270px;
            }
            
            .map-wrapper #status-panel {
                left: 280px;
            }
            
            .map-wrapper #view-mode-toggle {
                left: 280px;
            }
            
            .gallery {
                grid-template-columns: 1fr;
            }
            
            .footer-content {
                grid-template-columns: 1fr;
                gap: 40px;
            }
        }
        
        @media (max-width: 640px) {
            .hero {
                min-height: 400px;
                height: 60vh;
            }
            
            .hero h1 {
                font-size: 1.8rem;
            }
            
            .hero p {
                font-size: 1rem;
            }
            
            .cta-button {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
            
            .section-title {
                font-size: 1.7rem;
            }
            
            .section-intro {
                font-size: 1rem;
            }
            
            .map-wrapper #map-container {
                height: 450px;
            }
            
            .map-wrapper #legend {
                bottom: 10px;
                right: 10px;
                padding: 8px;
                max-width: 180px;
                font-size: 10px;
            }
            
            .map-wrapper #sidebar {
                width: 250px;
            }
            
            .map-wrapper #toggle-sidebar {
                left: 250px;
            }
            
            .map-wrapper .sidebar-content {
                padding: 10px;
            }
            
            .map-wrapper .map-control-btn {
                width: 36px;
                height: 36px;
                font-size: 16px;
                margin-bottom: 4px;
            }
            
            .prevention-item {
                padding: 20px;
            }
            
            .prevention-item i {
                font-size: 2rem;
            }
            
            .prevention-item h3 {
                font-size: 1.3rem;
            }
            
            .gallery-item {
                height: 180px;
            }
        }
        
        /* Interactive Elements */
        .btn {
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-primary:hover, .btn-primary:focus {
            background-color: #e03e00;
            border-color: #e03e00;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(255, 69, 0, 0.3);
        }
        
        .btn-outline-primary {
            color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-outline-primary:hover, .btn-outline-primary:focus {
            background-color: var(--primary-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(255, 69, 0, 0.3);
        }
        
        .form-select:focus, .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(255, 69, 0, 0.25);
        }
        
        .form-check-input:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .form-range::-webkit-slider-thumb {
            background: var(--primary-color);
        }
        
        .form-range::-moz-range-thumb {
            background: var(--primary-color);
        }
        
        .form-range::-ms-thumb {
            background: var(--primary-color);
        }
    </style>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="navbar">
        <div class="navbar-container">
            <a href="index.html" class="logo-link">
                <div class="logo-container">
                    <img src="/images/eyeonthefire-logo.png" alt="Eye on the Fire Logo" id="navbar-logo">
                    <span>Eye on the Fire</span>
                </div>
            </a>
            <button class="hamburger" aria-label="Toggle navigation" aria-expanded="false">
                <span class="line line1"></span>
                <span class="line line2"></span>
                <span class="line line3"></span>
            </button>
            <nav class="nav-menu" id="main-nav">
                <ul class="main-menu">
                    <li><a href="index.html" class="active">Home</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="prepare.html">Prepare</a></li>
                    <li><a href="prevent.html">Prevent</a></li>
                    <li><a href="safety-info.html">Safety Info</a></li>
                    <li><a href="news-resources.html">News & Resources</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>
    <section class="hero" id="home">
        <div class="hero-content">
            <h1>Monitor US Wildfires in Real-Time</h1>
            <p>Track active fires across the United States with our live interactive map. Get critical updates, safety alerts, and preparedness resources.</p>
            <a href="#map-section" class="cta-button">View Live US Fire Map</a>
        </div>
    </section>
    <section id="intro" class="content-section">
        <div class="container">
            <p class="section-intro">Welcome to Eye on the Fire, your central hub for tracking active <strong>wildfires near me</strong> across the United States. Our advanced <strong>interactive fire map</strong> provides <strong>real-time fire monitoring</strong>, helping you stay aware of developing situations and make informed decisions for your safety during the challenging <strong>US fire season</strong>. Explore the map below and utilize our resources for effective <strong>wildfire safety</strong> and <strong>emergency preparedness</strong>.</p>
        </div>
    </section>
    <hr class="section-divider">
    <section id="map-section" class="content-section">
        <div class="container">
            <h2 class="section-title">Interactive Live US Wildfire Tracker</h2>
            <p class="section-intro">Monitor the latest wildfire activity nationwide. Use the map controls to find <strong>fires near you</strong> anywhere in the US, zoom into specific regions, and explore data layers for a comprehensive view of <strong>current wildfires</strong> and activity.</p>
            <div class="map-usage-guide" role="region" aria-labelledby="map-guide-heading">
                <h4 id="map-guide-heading"><i class="fas fa-map-marked-alt" aria-hidden="true"></i> How to Use the Map:</h4>
                <ul>
                    <li><i class="fas fa-location-crosshairs" aria-hidden="true"></i><span>Click <strong>Locate Me</strong> to center the map on your current position and find potential <strong>wildfires near me</strong>.</span></li>
                    <li><i class="fas fa-search-plus" aria-hidden="true"></i><span>Use the <strong>+/- buttons</strong> or pinch/scroll to zoom in and out for regional detail.</span></li>
                    <li><i class="fas fa-undo" aria-hidden="true"></i><span>Click <strong>Reset View</strong> to return to the initial nationwide map extent.</span></li>
                    <li><i class="fas fa-fire" aria-hidden="true"></i><span>Fire icons indicate detected hotspots or reported incidents. Click icons for available details.</span></li>
                </ul>
            </div>
        </div>
        <main>
            <div class="map-wrapper">
                <div id="map-container">
                    <div id="map"></div>
                    <!-- Custom Tooltip -->
                    <div id="custom-tooltip"></div>
                    <!-- Sidebar -->
                    <div id="sidebar">
                        <div class="sidebar-header">
                            <h4><i class="fas fa-fire-flame-curved"></i> USA Fire Map</h4>
                            <p class="text-muted mb-0" style="font-size: 12px;">NASA FIRMS Real-Time Fire Data</p>
                        </div>
                        <div class="sidebar-content">
                            <div id="active-filters"></div>
                            <div class="sidebar-section">
                                <h5>Quick View</h5>
                                <div class="region-buttons">
                                    <div id="usa-button" class="region-button active" data-bounds="-125,24,-66,49">USA</div>
                                    <div id="west-button" class="region-button" data-bounds="-125,31,-107,49">West</div>
                                    <div id="central-button" class="region-button" data-bounds="-107,31,-90,49">Central</div>
                                    <div id="east-button" class="region-button" data-bounds="-90,24,-66,49">East</div>
                                    <div id="alaska-button" class="region-button" data-bounds="-170,51,-130,71">Alaska</div>
                                    <div id="hawaii-button" class="region-button" data-bounds="-160,18,-154,23">Hawaii</div>
                                </div>
                            </div>
                            <div class="sidebar-section">
                                <h5>Data Source</h5>
                                <div class="form-group">
                                    <select id="data-source" class="form-select form-select-sm">
                                        <option value="MODIS_NRT">MODIS (Near Real-Time)</option>
                                        <option value="VIIRS_NOAA20_NRT">VIIRS NOAA-20 (Near Real-Time)</option>
                                        <option value="VIIRS_SNPP_NRT">VIIRS Suomi NPP (Near Real-Time)</option>
                                        <option value="VIIRS_NOAA21_NRT">VIIRS NOAA-21 (Near Real-Time)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="sidebar-section">
                                <h5>Time Range</h5>
                                <div class="form-group">
                                    <select id="days-range" class="form-select form-select-sm">
                                        <option value="1">Last 24 hours</option>
                                        <option value="2">Last 2 days</option>
                                        <option value="3">Last 3 days</option>
                                        <option value="7">Last 7 days</option>
                                        <option value="10">Last 10 days</option>
                                    </select>
                                </div>
                            </div>
                            <div class="sidebar-section">
                                <h5>Fire Filters</h5>
                                <div class="form-group">
                                    <label for="confidence-range">Confidence Level: <span id="confidence-min">0%</span></label>
                                    <input type="range" class="form-range" id="confidence-range" min="0" max="100" value="0">
                                </div>
                                <div class="form-group">
                                    <label for="frp-range">Fire Power (MW): <span id="frp-min">0</span></label>
                                    <input type="range" class="form-range" id="frp-range" min="0" max="100" value="0">
                                </div>
                            </div>
                            <div class="sidebar-section">
                                <h5>Display Options</h5>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="enable-clustering" checked>
                                    <label class="form-check-label" for="enable-clustering">Enable Clustering</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="show-heatmap">
                                    <label class="form-check-label" for="show-heatmap">Show Heatmap</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="lazy-loading" checked>
                                    <label class="form-check-label" for="lazy-loading">Lazy Load Data (Recommended)</label>
                                    <small class="form-text text-muted d-block">Only loads data for visible map area</small>
                                </div>
                                <div class="form-group mt-2">
                                    <label for="markers-per-page">Max Visible Markers</label>
                                    <select id="markers-per-page" class="form-select form-select-sm">
                                        <option value="500">500 (Fast)</option>
                                        <option value="1000" selected>1,000 (Balanced)</option>
                                        <option value="3000">3,000 (Detailed)</option>
                                        <option value="10000">10,000 (Full)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="sidebar-section">
                                <button id="apply-filters" class="btn btn-primary btn-sm w-100">
                                    <i class="fas fa-filter"></i> Apply Filters
                                </button>
                                <button id="reset-filters" class="btn btn-outline-secondary btn-sm w-100 mt-2">
                                    <i class="fas fa-sync"></i> Reset Filters
                                </button>
                            </div>
                            <div class="pagination-container">
                                <div class="btn-group pagination">
                                    <button id="prev-page" class="btn btn-sm btn-outline-secondary">
                                        <i class="fas fa-chevron-left"></i>
                                    </button>
                                    <span id="page-info" class="btn btn-sm btn-outline-secondary disabled">
                                        <span id="current-page">1</span>/<span id="total-pages">1</span>
                                    </span>
                                    <button id="next-page" class="btn btn-sm btn-outline-secondary">
                                        <i class="fas fa-chevron-right"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="toggle-sidebar">
                        <i class="fas fa-chevron-left"></i>
                    </div>
                    <!-- Map Controls -->
                    <div class="map-controls">
                        <button class="map-control-btn" id="zoom-in" title="Zoom In">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="map-control-btn" id="zoom-out" title="Zoom Out">
                            <i class="fas fa-minus"></i>
                        </button>
                        <button class="map-control-btn" id="recenter" title="Recenter Map">
                            <i class="fas fa-location-crosshairs"></i>
                        </button>
                        <button class="map-control-btn" id="show-stats" title="Show Statistics">
                            <i class="fas fa-chart-simple"></i>
                        </button>
                    </div>
                    <!-- Legend -->
                    <div id="legend">
                        <h6 style="font-size: 12px; margin-top: 0;">Fire Confidence</h6>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #FF0000;"></div>
                            <span>High (80-100%)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #FF4500;"></div>
                            <span>Medium (60-79%)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #FFA500;"></div>
                            <span>Low (30-59%)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #FFCC00;"></div>
                            <span>Very Low (0-29%)</span>
                        </div>
                        <div style="margin-top: 6px; font-size: 10px;">
                            <strong>Circle Size:</strong> Fire Power (MW)
                        </div>
                        <div class="color-scale">
                            <div style="background-color: #FFCC00;"></div>
                            <div style="background-color: #FFA500;"></div>
                            <div style="background-color: #FF4500;"></div>
                            <div style="background-color: #FF0000;"></div>
                        </div>
                    </div>
                    <!-- Status Panel -->
                    <div id="status-panel"></div>
                    <!-- View Mode Toggle -->
                    <div id="view-mode-toggle">
                        <button id="global-mode" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-globe"></i> Global View
                        </button>
                        <button id="usa-mode" class="btn btn-sm btn-primary">
                            <i class="fas fa-flag-usa"></i> USA Only
                        </button>
                    </div>
                    <!-- Region Loading Indicator -->
                    <div id="region-loading" class="region-loading">
                        <span class="region-loading-spinner"></span>
                        Loading fire data for this region...
                    </div>
                    <!-- Loading Data Message -->
                    <div id="loading-data-message" class="loading-data-message">
                        <span class="loading-data-spinner"></span>
                        Loading USA fire data...
                    </div>
                    <!-- Stats Panel -->
                    <div id="stats-panel">
                        <div class="stats-title">
                            <i class="fas fa-chart-simple"></i> Fire Statistics
                            <button type="button" class="btn-close float-end" id="close-stats" aria-label="Close"></button>
                        </div>
                        <div id="stats-content"></div>
                    </div>
                    <!-- Loading Overlay -->
                    <div class="loading-overlay" id="loading-overlay">
                        <div class="spinner"></div>
                        <p id="loading-message">Initializing map...</p>
                    </div>
                </div>
            </div>
        </main>
        <div class="container data-source-note">
            <small>Map data sourced from NASA FIRMS, NIFC, and other official US channels. Updates occur periodically. Always follow guidance from local emergency management officials.</small>
        </div>
    </section>
    <hr class="section-divider">
    <section id="about" class="content-section">
        <div class="container">
            <h2 class="section-title">Stay Informed, Stay Safe Nationwide</h2>
            <p class="section-intro">As wildfire risks impact communities across the <strong>United States</strong>, access to reliable, timely information is paramount. Eye on the Fire provides an essential service through our premier <strong>interactive fire map</strong>, consolidating data for clear, actionable insights nationwide. Our platform aids residents from coast to coast in assessing potential threats with <strong>real-time fire monitoring</strong>. Understanding current fire behavior is key to effective <strong>emergency preparedness</strong> and comprehensive <strong>fire safety</strong>. Trust Eye on the Fire for situational awareness.</p>
        </div>
    </section>
    <hr class="section-divider">
    <section id="prevention" class="content-section">
        <div class="container">
            <h2 class="section-title">Wildfire Prevention & Home Safety Guides</h2>
            <p class="section-intro">Protecting your property starts long before a wildfire approaches. Implementing <strong>fire prevention</strong> strategies like <strong>home hardening</strong> and creating <strong>defensible space</strong> are the most effective ways to increase your home's chance of survival, regardless of your location in the US. Explore these fundamental guides to build your <strong>wildfire action plan</strong>.</p>
            <div class="prevention-grid">
                <div class="prevention-item">
                    <i class="fas fa-home" aria-hidden="true"></i>
                    <h3>Defensible Space Zones</h3>
                    <p>Learn how to create and maintain recommended buffer zones around your home to reduce flammable vegetation and help stop fire spread. Essential nationwide guidance.</p>
                </div>
                <div class="prevention-item">
                    <i class="fas fa-tools" aria-hidden="true"></i>
                    <h3>Home Hardening Techniques</h3>
                    <p>Discover methods to make your home more resistant to embers and flames, focusing on roofs, vents, windows, siding, and decks applicable across the US.</p>
                </div>
                <div class="prevention-item">
                    <i class="fas fa-seedling" aria-hidden="true"></i>
                    <h3>Fire-Smart Landscaping</h3>
                    <p>Choose appropriate vegetation and spacing for plants near your home. Utilize fire-resistant native plants and maintain adequate irrigation for your climate zone.</p>
                </div>
            </div>
        </div>
    </section>
    <hr class="section-divider">
    <section id="community" class="content-section">
        <div class="container">
            <h2 class="section-title">National & Local Resources</h2>
            <p class="section-intro">Access official resources for emergency alerts, evacuation status, and support during wildfire events across the United States.</p>
            <div class="cta-banner">
                <p>Find National Interagency Fire Center (NIFC) Updates: <a href="https://www.nifc.gov/" target="_blank" rel="noopener noreferrer">Visit NIFC.gov</a></p>
            </div>
            <div class="gallery" role="list" aria-label="Community and wildfire images">
                <div class="gallery-item" role="listitem"><img src="/images/us-wildfire-community-response.jpg" alt="Diverse group of community members clearing brush together for wildfire prevention in a US neighborhood"></div>
                <div class="gallery-item" role="listitem"><img src="/images/us-firefighters-working.jpg" alt="US firefighters monitoring a controlled burn or wildfire line in a forested area"></div>
                <div class="gallery-item" role="listitem"><img src="/images/us-wildfire-landscape-recovery.jpg" alt="Wide landscape view showing ecological recovery with green shoots emerging after a US wildfire"></div>
            </div>
        </div>
    </section>
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-section about">
                <h3 class="logo-text-footer">Eye on the Fire</h3>
                <p>Providing critical real-time wildfire monitoring and fire safety resources for the United States. Our interactive map helps you stay informed and prepared.</p>
            </div>
            <div class="footer-section links">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="about.html">About</a></li>
                    <li><a href="prepare.html">Prepare</a></li>
                    <li><a href="prevent.html">Prevent</a></li>
                    <li><a href="safety-info.html">Safety Info</a></li>
                    <li><a href="news-resources.html">News & Resources</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </div>
            <div class="footer-section social">
                <h3>Follow Us</h3>
                <div class="social-icons">
                    <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                    <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                    <a href="#" aria-label="RSS Feed"><i class="fas fa-rss"></i></a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
             <span id="year"></span> Eye on the Fire | All Rights Reserved | Data provided "as is" without warranty |
            <a href="#">Terms of Use</a> |
            <a href="#">Privacy Policy</a>
        </div>
    </footer>
    <script src="https://unpkg.com/@googlemaps/markerclusterer@2.0.15/dist/index.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        class FireMap {
            constructor() {
                this.config = {
                    apiEndpoint: '/api/nasa/firms', // Relative path for Cloudflare compatibility
                    defaultCenter: { lat: 39.5, lng: -98.35 },
                    defaultZoom: 4,
                    usBounds: { west: -125, south: 24, east: -66, north: 49 },
                    maxFetchRetries: 3,
                    mobileBreakpoint: 768,
                    retryDelay: 1000, // Base delay for retry (ms)
                    maxRetryDelay: 8000 // Maximum delay between retries (ms)
                };
                this.state = {
                    map: null,
                    viewport: { north: 0, south: 0, east: 0, west: 0 },
                    mapBounds: null,
                    markers: [],
                    markerClusterer: null,
                    heatmap: null,
                    totalFirePoints: 0,
                    filteredData: [],
                    allFireData: [],
                    currentPage: 1,
                    markersPerPage: 1000,
                    activeFilters: {},
                    infoWindow: null,
                    regionDataCache: new Map(),
                    viewMode: 'usa',
                    lazyLoading: true,
                    loadingRegions: new Set(),
                    isMobile: window.innerWidth < 768,
                    mapLoaded: false,
                    networkStatus: 'online',
                    lastError: null,
                    abortControllers: new Map() // For cancellable fetch requests
                };
                this.initialize();
            }

            async initialize() {
                console.log('Initializing FireMap application');
                this.checkMobile();
                this.setupEventListeners();
                this.setupNetworkListeners();
                
                try {
                    await this.waitForGoogleMaps();
                    this.initializeMap();
                    this.showLoadingMessage('Loading USA fire data...');
                    await this.loadUSAFireData();
                    this.hideLoadingMessage();
                    this.state.mapLoaded = true;
                    
                    // Add fade-in animation to visible elements
                    document.querySelectorAll('.map-control-btn, #legend, #toggle-sidebar').forEach(el => {
                        el.classList.add('fade-in');
                    });
                } catch (error) {
                    console.error('Error initializing application:', error);
                    this.state.lastError = error;
                    this.showStatus('Error initializing application: ' + error.message, 'error');
                    this.hideLoadingMessage();
                    
                    // Show fallback message in map container
                    const mapElement = document.getElementById('map');
                    if (mapElement) {
                        mapElement.innerHTML = `
                            <div style="height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; background-color: #f1f1f1;">
                                <h3>Map Loading Error</h3>
                                <p>${error.message || 'We couldn\'t load the fire map. Please try refreshing the page.'}</p>
                                <button onclick="location.reload()" class="btn btn-primary">Refresh Page</button>
                            </div>
                        `;
                    }
                }
            }

            setupNetworkListeners() {
                // Listen for online/offline status changes
                window.addEventListener('online', () => {
                    console.log('Network status: online');
                    this.state.networkStatus = 'online';
                    
                    if (this.state.lastError && this.state.mapLoaded) {
                        this.showStatus('Network connection restored. Refreshing data...', 'success');
                        setTimeout(() => {
                            if (this.state.viewMode === 'usa') {
                                this.loadUSAFireData();
                            } else {
                                this.loadDataForViewport();
                            }
                        }, 1000);
                    }
                });
                
                window.addEventListener('offline', () => {
                    console.log('Network status: offline');
                    this.state.networkStatus = 'offline';
                    this.showStatus('Network connection lost. Some features may not work.', 'warning');
                });
            }

            checkMobile() {
                this.state.isMobile = window.innerWidth < this.config.mobileBreakpoint;
                if (this.state.isMobile) {
                    setTimeout(() => {
                        $('#sidebar').addClass('collapsed');
                        $('#toggle-sidebar').addClass('collapsed');
                        $('#toggle-sidebar i').removeClass('fa-chevron-left').addClass('fa-chevron-right');
                        $('#status-panel').addClass('sidebar-collapsed');
                        $('#view-mode-toggle').addClass('sidebar-collapsed');
                    }, 500);
                }
            }

            waitForGoogleMaps() {
                return new Promise((resolve) => {
                    const maxWaitTime = 15000; // 15 seconds maximum wait time
                    const checkInterval = 100; // Check every 100ms
                    
                    if (typeof google !== 'undefined' && typeof google.maps !== 'undefined') {
                        console.log('Google Maps already loaded');
                        resolve();
                        return;
                    }
                    
                    console.log('Waiting for Google Maps to load');
                    
                    // Create a timeout to handle the case where Google Maps doesn't load
                    const timeout = setTimeout(() => {
                        console.error('Google Maps failed to load within timeout');
                        // Still resolve to allow the app to continue with fallback
                        resolve();
                    }, maxWaitTime);
                    
                    // Check if Google Maps is loaded at regular intervals
                    const intervalId = setInterval(() => {
                        if (typeof google !== 'undefined' && typeof google.maps !== 'undefined') {
                            clearInterval(intervalId);
                            clearTimeout(timeout);
                            console.log('Google Maps loaded successfully');
                            resolve();
                        }
                    }, checkInterval);
                });
            }

            initializeMap() {
                this.showStatus('Initializing map...');
                try {
                    console.log('Creating Google Map instance');
                    // Make sure the map element exists
                    const mapElement = document.getElementById('map');
                    if (!mapElement) {
                        throw new Error('Map container element not found');
                    }
                    
                    // Check if Google Maps API is available
                    if (typeof google === 'undefined' || typeof google.maps === 'undefined') {
                        throw new Error('Google Maps API not loaded');
                    }
                    
                    const mapOptions = {
                        center: this.config.defaultCenter,
                        zoom: this.config.defaultZoom,
                        mapTypeId: 'terrain',
                        mapTypeControl: true,
                        mapTypeControlOptions: {
                            style: google.maps.MapTypeControlStyle.DROPDOWN_MENU,
                            position: google.maps.ControlPosition.TOP_LEFT
                        },
                        fullscreenControl: false,
                        streetViewControl: false,
                        zoomControlOptions: {
                            position: google.maps.ControlPosition.RIGHT_BOTTOM
                        },
                        restriction: {
                            latLngBounds: { north: 85, south: -85, west: -180, east: 180 }
                        },
                        styles: [
                            {
                                featureType: "water",
                                elementType: "geometry",
                                stylers: [
                                    { color: "#e9e9e9" },
                                    { lightness: 17 }
                                ]
                            },
                            {
                                featureType: "landscape",
                                elementType: "geometry",
                                stylers: [
                                    { color: "#f5f5f5" },
                                    { lightness: 20 }
                                ]
                            },
                            {
                                featureType: "poi.park",
                                elementType: "geometry",
                                stylers: [
                                    { color: "#c5e8c5" },
                                    { lightness: 21 }
                                ]
                            }
                        ]
                    };
                    
                    // Create the map instance
                    this.state.map = new google.maps.Map(mapElement, mapOptions);
                    this.state.infoWindow = new google.maps.InfoWindow();
                    
                    // Add event listener for map bounds changes
                    google.maps.event.addListener(this.state.map, 'idle', () => {
                        const bounds = this.state.map.getBounds();
                        if (bounds) {
                            const ne = bounds.getNorthEast();
                            const sw = bounds.getSouthWest();
                            this.state.viewport = {
                                north: ne.lat(),
                                east: ne.lng(),
                                south: sw.lat(),
                                west: sw.lng()
                            };
                            if (this.state.lazyLoading && this.state.mapLoaded) {
                                this.loadDataForViewport();
                            }
                        }
                    });
                    
                    this.focusOnUSA();
                    this.hideLoading();
                    this.showStatus('Map initialized successfully', 'success');
                    console.log('Map initialized successfully');
                    return true;
                } catch (error) {
                    console.error('Error initializing map:', error);
                    this.showStatus('Error initializing map: ' + error.message, 'error');
                    this.state.lastError = error;
                    
                    // Create a fallback for when Google Maps fails to load
                    const mapElement = document.getElementById('map');
                    if (mapElement) {
                        mapElement.innerHTML = `
                            <div style="height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; background-color: #f1f1f1; padding: 20px; text-align: center;">
                                <i class="fas fa-exclamation-triangle fa-3x" style="color: #ff4500; margin-bottom: 15px;"></i>
                                <h3>Map Loading Error</h3>
                                <p>We couldn't load the fire map. This may be due to network connectivity issues or because Google Maps is temporarily unavailable.</p>
                                <button onclick="location.reload()" class="btn btn-primary">
                                    <i class="fas fa-sync-alt"></i> Refresh Page
                                </button>
                            </div>
                        `;
                    }
                    
                    return false;
                }
            }

            setupEventListeners() {
                console.log('Setting up event listeners');
                
                // Sidebar toggle
                $('#toggle-sidebar').on('click', () => {
                    $('#sidebar').toggleClass('collapsed');
                    $('#toggle-sidebar').toggleClass('collapsed');
                    $('#status-panel').toggleClass('sidebar-collapsed');
                    $('#view-mode-toggle').toggleClass('sidebar-collapsed');
                    
                    if ($('#sidebar').hasClass('collapsed')) {
                        $('#toggle-sidebar i').removeClass('fa-chevron-left').addClass('fa-chevron-right');
                    } else {
                        $('#toggle-sidebar i').removeClass('fa-chevron-right').addClass('fa-chevron-left');
                    }
                });
                
                // Map controls
                $('#zoom-in').on('click', () => {
                    if (this.state.map) {
                        const currentZoom = this.state.map.getZoom();
                        this.state.map.setZoom(currentZoom + 1);
                    }
                });
                
                $('#zoom-out').on('click', () => {
                    if (this.state.map) {
                        const currentZoom = this.state.map.getZoom();
                        this.state.map.setZoom(currentZoom - 1);
                    }
                });
                
                $('#recenter').on('click', () => {
                    this.recenterMap();
                });
                
                $('#show-stats').on('click', () => {
                    this.showStatistics();
                });
                
                $('#close-stats').on('click', () => {
                    $('#stats-panel').hide();
                });
                
                // Filter controls
                $('#apply-filters').on('click', () => {
                    this.applyFilters();
                });
                
                $('#reset-filters').on('click', () => {
                    this.resetFilters();
                });
                
                // Region buttons
                $('.region-button').on('click', (e) => {
                    const $btn = $(e.currentTarget);
                    $('.region-button').removeClass('active');
                    $btn.addClass('active');
                    
                    const bounds = $btn.data('bounds');
                    if (bounds) {
                        const [west, south, east, north] = bounds.split(',').map(Number);
                        this.focusOnRegion(north, south, east, west);
                    }
                });
                
                // View mode toggle
                $('#usa-mode').on('click', () => {
                    this.setViewMode('usa');
                    $('#usa-mode').removeClass('btn-outline-primary').addClass('btn-primary');
                    $('#global-mode').removeClass('btn-primary').addClass('btn-outline-primary');
                    this.focusOnUSA();
                });
                
                $('#global-mode').on('click', () => {
                    this.setViewMode('global');
                    $('#global-mode').removeClass('btn-outline-primary').addClass('btn-primary');
                    $('#usa-mode').removeClass('btn-primary').addClass('btn-outline-primary');
                });
                
                // Pagination controls
                $('#prev-page').on('click', () => {
                    if (this.state.currentPage > 1) {
                        this.state.currentPage--;
                        this.updateMarkers();
                    }
                });
                
                $('#next-page').on('click', () => {
                    const totalPages = this.getTotalPages();
                    if (this.state.currentPage < totalPages) {
                        this.state.currentPage++;
                        this.updateMarkers();
                    }
                });
                
                // Display options
                $('#show-heatmap').on('change', () => {
                    this.toggleHeatmap($('#show-heatmap').is(':checked'));
                });
                
                $('#enable-clustering').on('change', () => {
                    this.updateMarkers();
                });
                
                $('#lazy-loading').on('change', () => {
                    this.state.lazyLoading = $('#lazy-loading').is(':checked');
                    if (!this.state.lazyLoading) {
                        if (this.state.viewMode === 'usa') {
                            this.loadUSAFireData();
                        } else {
                            this.loadWorldFireData();
                        }
                    }
                });
                
                $('#markers-per-page').on('change', () => {
                    this.state.markersPerPage = parseInt($('#markers-per-page').val());
                    this.state.currentPage = 1;
                    this.updateMarkers();
                });
                
                // Range slider displays
                $('#confidence-range').on('input', function() {
                    const value = parseInt($(this).val());
                    $('#confidence-min').text(value + '%');
                });
                
                $('#frp-range').on('input', function() {
                    const value = parseInt($(this).val());
                    if (value === 0) {
                        $('#frp-min').text('0');
                    } else {
                        $('#frp-min').text(value);
                    }
                });
                
                // Window resize handler with debounce
                let resizeTimer;
                window.addEventListener('resize', () => {
                    clearTimeout(resizeTimer);
                    resizeTimer = setTimeout(() => {
                        this.checkMobile();
                        
                        // Handle responsive adjustments if map is loaded
                        if (this.state.map) {
                            google.maps.event.trigger(this.state.map, 'resize');
                        }
                    }, 250);
                });
                
                // Mobile nav menu toggle
                $('.hamburger').on('click', function() {
                    $(this).toggleClass('active');
                    $('.nav-menu').toggleClass('active');
                    $(this).attr('aria-expanded', $(this).hasClass('active'));
                });
                
                // Close menu when clicking outside on mobile
                $(document).on('click', (e) => {
                    const $hamburger = $('.hamburger');
                    const $navMenu = $('.nav-menu');
                    
                    if ($hamburger.hasClass('active') && 
                        !$(e.target).closest('.hamburger').length && 
                        !$(e.target).closest('.nav-menu').length) {
                        $hamburger.removeClass('active');
                        $navMenu.removeClass('active');
                        $hamburger.attr('aria-expanded', 'false');
                    }
                });
                
                // Handle document visibility changes
                document.addEventListener('visibilitychange', () => {
                    if (document.visibilityState === 'visible' && this.state.mapLoaded) {
                        // Refresh data when coming back to the tab after being hidden
                        console.log('Document became visible, refreshing data if needed');
                        
                        // Only refresh if it's been more than 5 minutes since last load
                        const now = new Date().getTime();
                        const lastLoadTime = this.state.lastLoadTime || 0;
                        
                        if (now - lastLoadTime > 5 * 60 * 1000) {
                            if (this.state.viewMode === 'usa') {
                                this.loadUSAFireData();
                            } else if (this.state.lazyLoading) {
                                this.loadDataForViewport();
                            }
                        }
                    }
                });
            }

            setViewMode(mode) {
                this.state.viewMode = mode;
                if (mode === 'usa') {
                    this.focusOnUSA();
                    this.loadUSAFireData();
                }
            }

            focusOnUSA() {
                if (!this.state.map) return;
                
                const bounds = new google.maps.LatLngBounds(
                    new google.maps.LatLng(this.config.usBounds.south, this.config.usBounds.west),
                    new google.maps.LatLng(this.config.usBounds.north, this.config.usBounds.east)
                );
                this.state.map.fitBounds(bounds);
            }

            focusOnRegion(north, south, east, west) {
                if (!this.state.map) return;
                
                const bounds = new google.maps.LatLngBounds(
                    new google.maps.LatLng(south, west),
                    new google.maps.LatLng(north, east)
                );
                this.state.map.fitBounds(bounds);
            }

            async loadDataForViewport() {
                if (!this.state.map) return;
                
                const viewportString = JSON.stringify(this.state.viewport);
                if (this.state.loadingRegions.has(viewportString)) {
                    return;
                }
                
                const isUSAViewport = this.isViewportInUSA();
                if (this.state.viewMode === 'usa' && !isUSAViewport) {
                    return;
                }
                
                if (this.state.regionDataCache.has(viewportString)) {
                    console.log('Using cached data for viewport:', this.state.viewport);
                    return;
                }
                
                this.state.loadingRegions.add(viewportString);
                this.showRegionLoading();
                
                try {
                    let url = this.config.apiEndpoint;
                    const params = new URLSearchParams();
                    const source = this.state.activeFilters.source?.value || 'MODIS_NRT';
                    params.append('source', source);
                    params.append('area', 'world');
                    const days = this.state.activeFilters.days?.value || '1';
                    params.append('days', days);
                    
                    // Add viewport bounds for server-side filtering
                    params.append('north', this.state.viewport.north.toFixed(4));
                    params.append('south', this.state.viewport.south.toFixed(4));
                    params.append('east', this.state.viewport.east.toFixed(4));
                    params.append('west', this.state.viewport.west.toFixed(4));
                    
                    url = `${url}?${params.toString()}`;
                    console.log(`Fetching fire data for viewport:`, this.state.viewport);
                    
                    // Generate a unique request ID for this viewport
                    const requestId = `viewport-${Date.now()}`;
                    
                    // Create an abort controller for this request
                    const controller = new AbortController();
                    this.state.abortControllers.set(requestId, controller);
                    
                    const response = await this.fetchWithRetry(url, { signal: controller.signal });
                    this.state.abortControllers.delete(requestId);
                    
                    if (response.ok) {
                        try {
                            const data = await response.json();
                            if (Array.isArray(data)) {
                                console.log(`Received ${data.length} fire data points`);
                                this.state.regionDataCache.set(viewportString, data);
                                this.mergeFireData(data);
                                this.filterData();
                                this.updateMarkers();
                                this.showStatus(`Loaded ${data.length} fire data points for this area`, 'success');
                            }
                        } catch (error) {
                            console.error('Error processing viewport data:', error);
                            this.showStatus('Error processing data: ' + error.message, 'error');
                        }
                    } else {
                        const errorText = await response.text();
                        throw new Error(`Server responded with status ${response.status}: ${errorText}`);
                    }
                } catch (error) {
                    // Ignore aborted requests
                    if (error.name === 'AbortError') {
                        console.log('Request was aborted:', error);
                        return;
                    }
                    
                    console.error('Error loading viewport data:', error);
                    this.showStatus('Error loading data: ' + error.message, 'error');
                } finally {
                    this.state.loadingRegions.delete(viewportString);
                    if (this.state.loadingRegions.size === 0) {
                        this.hideRegionLoading();
                    }
                }
            }

            mergeFireData(newData) {
                if (!Array.isArray(newData)) {
                    console.error('Invalid data format received:', newData);
                    return;
                }
                
                if (this.state.allFireData.length === 0) {
                    this.state.allFireData = [...newData];
                    return;
                }
                
                const existingIds = new Set();
                this.state.allFireData.forEach(point => {
                    const id = `${point.latitude},${point.longitude},${point.acq_date || ''},${point.acq_time || ''}`;
                    existingIds.add(id);
                });
                
                const uniqueNewData = newData.filter(point => {
                    const id = `${point.latitude},${point.longitude},${point.acq_date || ''},${point.acq_time || ''}`;
                    return !existingIds.has(id);
                });
                
                this.state.allFireData = [...this.state.allFireData, ...uniqueNewData];
                console.log(`Added ${uniqueNewData.length} new unique fire points`);
            }

            filterDataToViewport(data, viewport) {
                return data.filter(point => {
                    const lat = parseFloat(point.latitude);
                    const lng = parseFloat(point.longitude);
                    return (
                        lat >= viewport.south &&
                        lat <= viewport.north &&
                        lng >= viewport.west &&
                        lng <= viewport.east
                    );
                });
            }

            isViewportInUSA() {
                const viewport = this.state.viewport;
                const usBounds = this.config.usBounds;
                
                // Check if the viewport intersects with the USA bounds
                return !(
                    viewport.north < usBounds.south ||
                    viewport.south > usBounds.north ||
                    viewport.east < usBounds.west ||
                    viewport.west > usBounds.east
                );
            }

            async loadUSAFireData() {
                // Cancel any pending viewport requests
                this.cancelPendingRequests();
                
                this.showStatus('Loading USA fire data...');
                this.showLoadingMessage('Loading USA fire data...');
                
                try {
                    let url = this.config.apiEndpoint;
                    const params = new URLSearchParams();
                    const source = this.state.activeFilters.source?.value || 'MODIS_NRT';
                    params.append('source', source);
                    params.append('area', 'usa'); // Request USA data specifically
                    const days = this.state.activeFilters.days?.value || '1';
                    params.append('days', days);
                    
                    url = `${url}?${params.toString()}`;
                    console.log(`Fetching USA fire data: ${url}`);
                    
                    const controller = new AbortController();
                    this.state.abortControllers.set('usa-load', controller);
                    
                    const response = await this.fetchWithRetry(url, { signal: controller.signal });
                    this.state.abortControllers.delete('usa-load');
                    
                    if (response.ok) {
                        try {
                            const data = await response.json();
                            
                            if (Array.isArray(data)) {
                                console.log(`Received ${data.length} USA fire data points`);
                                this.processFireData(data);
                                this.showStatus(`Loaded ${data.length} USA fire data points`, 'success');
                                
                                // Update last load time
                                this.state.lastLoadTime = new Date().getTime();
                                this.state.lastError = null;
                            } else if (data.error) {
                                throw new Error(data.message || 'Unknown API error');
                            } else {
                                throw new Error('Unexpected response format from API');
                            }
                        } catch (error) {
                            console.error(`Error parsing API response: ${error.message}`);
                            throw error;
                        }
                    } else {
                        const errorText = await response.text();
                        throw new Error(`API responded with status ${response.status}: ${errorText}`);
                    }
                } catch (error) {
                    // Ignore aborted requests
                    if (error.name === 'AbortError') {
                        console.log('USA data load request was aborted');
                        return;
                    }
                    
                    console.error(`Error loading USA fire data: ${error.message}`);
                    this.showStatus(`Error loading USA fire data: ${error.message}`, 'error');
                    this.state.lastError = error;
                    
                    if (this.state.allFireData.length === 0) {
                        console.warn('Generating sample data as fallback');
                        this.generateSampleData();
                    }
                } finally {
                    this.hideLoadingMessage();
                }
            }

            cancelPendingRequests() {
                // Cancel all pending fetch requests
                for (const [id, controller] of this.state.abortControllers.entries()) {
                    console.log(`Cancelling request: ${id}`);
                    controller.abort();
                }
                this.state.abortControllers.clear();
            }

            filterDataToUSA(data) {
                const usBounds = this.config.usBounds;
                const alaskaBounds = { west: -170, south: 51, east: -130, north: 71 };
                const hawaiiBounds = { west: -160, south: 18, east: -154, north: 23 };
                
                return data.filter(point => {
                    const lat = parseFloat(point.latitude);
                    const lng = parseFloat(point.longitude);
                    
                    const inContUS = (
                        lat >= usBounds.south &&
                        lat <= usBounds.north &&
                        lng >= usBounds.west &&
                        lng <= usBounds.east
                    );
                    
                    const inAlaska = (
                        lat >= alaskaBounds.south &&
                        lat <= alaskaBounds.north &&
                        lng >= alaskaBounds.west &&
                        lng <= alaskaBounds.east
                    );
                    
                    const inHawaii = (
                        lat >= hawaiiBounds.south &&
                        lat <= hawaiiBounds.north &&
                        lng >= hawaiiBounds.west &&
                        lng <= hawaiiBounds.east
                    );
                    
                    return inContUS || inAlaska || inHawaii;
                });
            }

            async loadWorldFireData() {
                // Cancel any pending requests
                this.cancelPendingRequests();
                
                if (!this.state.lazyLoading) {
                    this.showLoadingMessage('Loading global fire data...');
                }
                
                this.showStatus('Loading global fire data...');
                
                try {
                    let url = this.config.apiEndpoint;
                    const params = new URLSearchParams();
                    const source = this.state.activeFilters.source?.value || 'MODIS_NRT';
                    params.append('source', source);
                    params.append('area', 'world');
                    const days = this.state.activeFilters.days?.value || '1';
                    params.append('days', days);
                    
                    // Add viewport bounds for more efficient data loading
                    const bounds = this.state.map?.getBounds();
                    if (bounds) {
                        const ne = bounds.getNorthEast();
                        const sw = bounds.getSouthWest();
                        params.append('north', ne.lat().toFixed(4));
                        params.append('south', sw.lat().toFixed(4));
                        params.append('east', ne.lng().toFixed(4));
                        params.append('west', sw.lng().toFixed(4));
                    }
                    
                    url = `${url}?${params.toString()}`;
                    console.log(`Fetching global fire data: ${url}`);
                    
                    const controller = new AbortController();
                    this.state.abortControllers.set('world-load', controller);
                    
                    const response = await this.fetchWithRetry(url, { signal: controller.signal });
                    this.state.abortControllers.delete('world-load');
                    
                    if (response.ok) {
                        try {
                            const data = await response.json();
                            
                            if (Array.isArray(data)) {
                                console.log(`Received ${data.length} global fire data points`);
                                this.processFireData(data);
                                this.showStatus(`Loaded ${data.length} global fire data points`, 'success');
                                
                                // Update last load time
                                this.state.lastLoadTime = new Date().getTime();
                                this.state.lastError = null;
                            } else if (data.error) {
                                throw new Error(data.message || 'Unknown API error');
                            } else {
                                throw new Error('Unexpected response format from API');
                            }
                        } catch (error) {
                            console.error(`Error parsing API response: ${error.message}`);
                            throw error;
                        }
                    } else {
                        const errorText = await response.text();
                        throw new Error(`API responded with status ${response.status}: ${errorText}`);
                    }
                } catch (error) {
                    // Ignore aborted requests
                    if (error.name === 'AbortError') {
                        console.log('World data load request was aborted');
                        return;
                    }
                    
                    console.error(`Error loading global fire data: ${error.message}`);
                    this.showStatus(`Error loading global fire data: ${error.message}`, 'error');
                    this.state.lastError = error;
                    
                    if (this.state.allFireData.length === 0) {
                        console.warn('Generating sample data as fallback');
                        this.generateSampleData();
                    }
                } finally {
                    if (!this.state.lazyLoading) {
                        this.hideLoadingMessage();
                    }
                }
            }

            recenterMap() {
                if (!this.state.map) return;
                
                if (navigator.geolocation) {
                    this.showStatus('Getting your location...');
                    
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const userLocation = {
                                lat: position.coords.latitude,
                                lng: position.coords.longitude
                            };
                            
                            // Set map to user's location
                            this.state.map.setCenter(userLocation);
                            this.state.map.setZoom(10);
                            
                            // Add a marker at user's location
                            new google.maps.Marker({
                                position: userLocation,
                                map: this.state.map,
                                icon: {
                                    path: google.maps.SymbolPath.CIRCLE,
                                    fillColor: '#4285F4',
                                    fillOpacity: 0.7,
                                    strokeColor: '#FFFFFF',
                                    strokeWeight: 2,
                                    scale: 8
                                },
                                title: 'Your Location'
                            });
                            
                            this.showStatus('Map centered on your location', '
