<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Eye on the Fire - Premier Interactive Fire Map & Live Updates</title>
  <meta name="description" content="Eye on the Fire is your premier destination to monitor active wildfires near you with our interactive live map. Get real-time updates, safety tips, and community insights instantly.">
  <meta name="keywords" content="interactive fire map, live wildfire updates, fires near me, real-time fire monitoring, fire safety, Eye on the Fire">
  <meta name="author" content="Eye on the Fire Team">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://eyeonthefire.com/"> <meta property="og:title" content="Eye on the Fire - Premier Interactive Fire Map">
  <meta property="og:description" content="Monitor active wildfires near you with Eye on the Fireâ€™s interactive live map. Stay updated with real-time fire data and safety resources.">
  <meta property="og:url" content="https://eyeonthefire.com/">
  <meta property="og:image" content="images/hero-bg.jpg"> <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">

  <link rel="shortcut icon" href="favicon/favicon.ico" type="image/x-icon">
  <link rel="icon" type="image/png" href="favicon/favicon-96x96.png" sizes="96x96">
  <link rel="apple-touch-icon" href="favicon/apple-touch-icon.png" sizes="180x180">
  <meta name="apple-mobile-web-app-title" content="eyeonthefire">
  <link rel="manifest" href="favicon/site.webmanifest">

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-T8RE6KDBEW"></script> <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-T8RE6KDBEW'); // TODO: Replace with your GA ID
  </script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/2.0.0/Control.FullScreen.min.css" integrity="sha512-DRkMa+fn898M1uc6s9JZeztUoXN6viuHsXmh/pgz3jG6a77YWO3U3QYEjLoqbxOeclc2NunWfMTya4Y5twXAKA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Open+Sans:wght@300;400&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="styles.css">

</head>
<body>

  <nav class="navbar">
    <div class="navbar-header">
        <a href="#" class="logo">
            <img src="images/fire-icon.png" alt="Eye on the Fire Logo">
            <span class="logo-text">Eye on the Fire</span>
        </a>
        <button class="hamburger" id="hamburger-menu" aria-label="Toggle Menu">
            <span class="line"></span><span class="line"></span><span class="line"></span>
        </button>
    </div>
    <ul class="nav-menu" id="nav-menu">
        <li><a href="#map-section">Live Map</a></li>
        <li><a href="#about">Why Us</a></li>
        <li><a href="#prevention">Prevention</a></li>
        <li><a href="#community">Community</a></li>
    </ul>
  </nav>

  <header class="hero" id="home">
    <h1>Monitor Wildfires in Real-Time</h1>
    <p>Your premier destination for live interactive fire maps, updates, and safety information.</p>
    <a href="#map-section" class="cta-button">View Live Fire Map</a>
  </header>

  <section id="map-section" class="map-section">
    <div class="map-wrapper" id="map-wrapper">
        <div class="map-header">Interactive Wildfire Map</div>
        <div id="fire-map">
            <div id="map-loading-message" style="position:absolute; top:50%; left:50%; transform: translate(-50%, -50%); font-size: 1.2em; color: #555; z-index: 1001;">Loading map data...</div>
            <div id="map-error-message" style="position:absolute; top:50%; left:50%; transform: translate(-50%, -50%); font-size: 1.2em; color: red; display: none; text-align:center; background: rgba(255,255,255,0.8); padding: 15px; border-radius: 5px; z-index: 1001;"></div>
        </div>
    </div>
    <div id="geolocation-error" style="text-align: center; color: #b71c1c; margin-top: 10px; display: none;">Could not get your location. Showing default view.</div>
  </section>

  <section id="about" class="content-section">
    <div class="container">
      <h2>Why Choose Eye on the Fire?</h2>
      <p>We provide the most up-to-date and comprehensive wildfire information available, combining data from multiple trusted sources like NASA and NIFC. Our easy-to-use interactive map helps you stay informed and safe.</p>
    </div>
  </section>

  <section id="prevention" class="content-section">
    <div class="container">
      <h2>Fire Prevention Tips</h2>
      <p>Protect your home and community by following these essential fire prevention practices.</p>
      <div class="prevention-grid">
        <div class="prevention-item"><h3>Clear Defensible Space</h3><p>Remove flammable vegetation, leaves, and debris from around your home (at least 30 feet).</p></div>
        <div class="prevention-item"><h3>Maintain Roof & Gutters</h3><p>Regularly clean roofs and gutters of pine needles, leaves, and other flammable materials.</p></div>
        <div class="prevention-item"><h3>Choose Fire-Resistant Landscaping</h3><p>Use native, drought-tolerant plants that are less likely to ignite easily.</p></div>
      </div>
    </div>
  </section>

  <section id="community" class="content-section">
      <div class="container">
          <h2>Community Resources & Updates</h2>
          <p>Stay connected with local resources and see updates from affected areas.</p>
          <div class="cta-banner"><p>Find local emergency services and evacuation information: <a href="#" target="_blank" rel="noopener noreferrer">Local Authority Website</a></p></div>
          <div class="gallery">
              <div class="gallery-item"><img src="images/community-1.jpg" alt="Community effort example"></div>
              <div class="gallery-item"><img src="images/community-2.jpg" alt="Firefighters working"></div>
              <div class="gallery-item"><img src="images/community-3.jpg" alt="Landscape after fire"></div>
          </div>
      </div>
  </section>

  <footer>
    <div class="container">
      <p>&copy; 2025 Eye on the Fire. All Rights Reserved.</p>
      <p><a href="#">Privacy Policy</a> | <a href="#">Terms of Service</a> | <a href="#">Contact Us</a></p>
      <div class="social-icons">
        <a href="#" target="_blank" rel="noopener noreferrer" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
        <a href="#" target="_blank" rel="noopener noreferrer" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
        <a href="#" target="_blank" rel="noopener noreferrer" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
      </div>
    </div>
  </footer>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/2.0.0/Control.FullScreen.min.js" integrity="sha512-c6ydt5Rypa1ptlnH2U1u+JybARYppbD1qxgythCI4pJ9EOfNYEWlLBjxBX926O3tq5p4Aw5GTY68vT0FdKbG3w==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
    // ========================================================================
    // !!! CRITICAL SECURITY WARNING !!!
    // API KEYS ARE CURRENTLY EXPOSED CLIENT-SIDE. MOVE SERVER-SIDE BEFORE PRODUCTION.
    // ========================================================================
    const NASA_API_KEY = 'd152217c8391eb5b0fbd242290527ae8'; // !!! MOVE SERVER-SIDE !!!
    const AIRNOW_API_KEY = '54044855-7B0C-4023-BEE4-8B3FCA172DED';   // !!! MOVE SERVER-SIDE !!!
    const OPENCAGE_API_KEY = 'a40b9e954e50458bbc09ca24e70201a1'; // !!! MOVE SERVER-SIDE !!!

    // Map Variables
    let map;
    let fireLayer = L.layerGroup();
    let airQualityLayer = L.layerGroup();
    let nifcLayer = L.layerGroup();
    let nwsLayer = L.layerGroup();
    let showFires = true;
    let showAirQuality = false;
    let showNIFC = true;
    let showNWS = true;

    // DOM Elements
    const hamburger = document.getElementById('hamburger-menu');
    const navMenu = document.getElementById('nav-menu');
    const mapLoadingMessage = document.getElementById('map-loading-message');
    const mapErrorMessage = document.getElementById('map-error-message');
    const geolocationErrorDiv = document.getElementById('geolocation-error');
    const mapWrapper = document.getElementById('map-wrapper');

    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', initializeMap);

    // --- Function Definitions (Moved Before Call in setupMap) ---

    function addMapControls() { /* ... same code ... */ }
    function addMapLegend() { /* ... same code ... */ }

    // --- Core Functions ---
    function initializeMap() {
      console.log("[Init] Initializing map...");
      mapLoadingMessage.style.display = 'block';
      mapErrorMessage.style.display = 'none';
      geolocationErrorDiv.style.display = 'none';

      if (navigator.geolocation) {
        console.log("[Init] Attempting geolocation...");
        navigator.geolocation.getCurrentPosition(
          (position) => {
            const userLat = position.coords.latitude;
            const userLon = position.coords.longitude;
            console.log('[Init] Geolocation successful:', userLat, userLon);
            setupMap([userLat, userLon], 10); // Use user's location
            // ** Add slight delay for invalidateSize after setupMap if needed, especially if success path also shows grey map sometimes **
            // setTimeout(() => { if (map) map.invalidateSize(); }, 100);
            loadInitialData(userLat, userLon);
          },
          (error) => {
            // *** UPDATED FALLBACK LOGIC with invalidateSize ***
            console.warn(`[Init] Geolocation error (${error.code}): ${error.message}`);
            const defaultLat = 37.0902; // Center of US
            const defaultLon = -95.7129;
            const defaultZoom = 5;      // Wider zoom
            geolocationErrorDiv.textContent = `Geolocation failed: ${error.message}. Showing default US view.`;
            geolocationErrorDiv.style.display = 'block';
            console.log("[Init] Geolocation failed, setting up map with default US view.");
            setupMap([defaultLat, defaultLon], defaultZoom);
            // *** ADDED: Force map size recalculation after a short delay ***
            setTimeout(() => {
                if (map) {
                    console.log("[Init Fallback] Calling map.invalidateSize()");
                    map.invalidateSize();
                } else {
                    console.error("[Init Fallback] Map object not found for invalidateSize call.");
                }
            }, 100); // 100ms delay
            loadInitialData(defaultLat, defaultLon);
          },
          { timeout: 8000 }
        );
      } else { /* ... No Geolocation Fallback ... */
        console.warn('[Init] Geolocation is not supported by this browser.');
        const defaultLat = 37.0902; const defaultLon = -95.7129; const defaultZoom = 5;
        geolocationErrorDiv.textContent = 'Geolocation not supported. Showing default US view.';
        geolocationErrorDiv.style.display = 'block';
        console.log("[Init] Geolocation not supported, setting up map with default US view.");
        setupMap([defaultLat, defaultLon], defaultZoom);
         // *** ADDED: Force map size recalculation after a short delay ***
        setTimeout(() => {
            if (map) {
                console.log("[Init No Geolocation] Calling map.invalidateSize()");
                map.invalidateSize();
            } else {
                console.error("[Init No Geolocation] Map object not found for invalidateSize call.");
            }
        }, 100); // 100ms delay
        loadInitialData(defaultLat, defaultLon);
      }
    }

    function setupMap(centerCoords, zoomLevel) { /* ... same map setup code ... */
        console.log("[Setup] Setting up Leaflet map centered at:", centerCoords, " Zoom:", zoomLevel); try { if (map) { map.remove(); map = null; } map = L.map('fire-map', { center: centerCoords, zoom: zoomLevel, fullscreenControl: true }); L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors | Fire Data: NASA FIRMS, NIFC | AQI: AirNow | Weather: NWS' }).addTo(map); console.log("[Setup] Adding initial layers to map object..."); if (showFires && fireLayer) fireLayer.addTo(map); if (showNIFC && nifcLayer) nifcLayer.addTo(map); if (showNWS && nwsLayer) nwsLayer.addTo(map); addMapControls(); addMapLegend(); map.on('fullscreenchange', function () { mapWrapper.classList.toggle('fullscreen', map.isFullscreen()); map.invalidateSize(); }); mapLoadingMessage.style.display = 'none'; console.log("[Setup] Map setup complete."); } catch(e) { console.error("[Setup] CRITICAL Error during map setup:", e); mapLoadingMessage.style.display = 'none'; displayMapError("Critical error setting up the map. Please refresh."); } }
    function loadInitialData(lat, lon) { /* ... same data loading code ... */
        console.log('[LoadData] Loading initial data for coords:', lat, lon); mapErrorMessage.style.display = 'none'; mapErrorMessage.textContent = ''; Promise.allSettled([ loadNIFCFires(), loadNWSWarnings(), loadFIRMSFires(lat, lon) ]).then(results => { console.log('[LoadData] Initial data loading promises settled.'); results.forEach((result, index) => { if (result.status === 'rejected') { console.error(`[LoadData] Promise ${index} rejected:`, result.reason); } }); }); }

    // --- Data Loading Functions ---
    async function loadFIRMSFires(lat, lon) { /* ... same code with bounding box and regex split ... */
        const apiKey = NASA_API_KEY; const placeholderKey = 'YOUR_NASA_FIRMS_API_KEY_HERE'; if (!apiKey || apiKey === placeholderKey) { console.warn('[FIRMS] API Key is missing...'); displayMapError('FIRMS data unavailable (API Key missing).'); fireLayer.clearLayers(); return; } const source = 'VIIRS_SNPP_NRT'; const lookbackDays = 2; const area = '-125,24,-66,50'; const url = `https://firms.modaps.eosdis.nasa.gov/api/area/csv/${apiKey}/${source}/${area}/${lookbackDays}`; console.log(`[FIRMS] Fetching FIRMS data for ${lookbackDays} days, bounding box:`, area); mapLoadingMessage.style.display = 'block'; let markerCount = 0; fireLayer.clearLayers();
      try { const response = await fetch(url); console.log("[FIRMS] Response Status:", response.status, response.statusText); if (!response.ok) { const errorText = await response.text(); console.error("[FIRMS] API Response Error Text:", errorText); if(response.status === 400 && errorText.toLowerCase().includes("invalid area")) { throw new Error(`API Error 400: Invalid Area format.`); } throw new Error(`API Error: ${response.status} ${response.statusText}`); } const csvData = await response.text(); console.log("[FIRMS] CSV Data Received (length):", csvData.length); const lines = csvData.trim().split(/\r?\n/); console.log("[FIRMS] CSV lines count:", lines.length); if (lines.length <= 1) { console.log("[FIRMS] No active FIRMS hotspots found..."); mapLoadingMessage.style.display = 'none'; return; } const headers = lines[0].split(','); const latIndex = headers.indexOf('latitude'); const lonIndex = headers.indexOf('longitude'); const brightIndex = headers.indexOf('bright_ti5'); const dateIndex = headers.indexOf('acq_date'); const timeIndex = headers.indexOf('acq_time'); const confidenceIndex = headers.indexOf('confidence'); if (latIndex === -1 || lonIndex === -1) { throw new Error("Invalid FIRMS CSV format."); } const fireIcon = L.icon({ iconUrl: 'images/fire-icon.png', iconSize: [25, 25], iconAnchor: [12, 25], popupAnchor: [0, -25] });
          lines.slice(1).forEach((line, index) => { console.log(`[FIRMS Processing Line ${index + 1}] Raw:`, line); try { const values = line.split(','); if (values.length > Math.max(latIndex, lonIndex)) { const latStr = values[latIndex]; const lonStr = values[lonIndex]; const lat = parseFloat(latStr); const lon = parseFloat(lonStr); console.log(`[FIRMS Processing Line ${index + 1}] Parsed lat: ${lat}, lon: ${lon}`); if (!isNaN(lat) && !isNaN(lon)) { const brightness = values[brightIndex] || 'N/A'; const date = values[dateIndex] || 'N/A'; const timeRaw = values[timeIndex] || ''; const time = timeRaw.padStart(4, '0'); const confidence = values[confidenceIndex] || 'N/A'; const marker = L.marker([lat, lon], { icon: fireIcon }).bindPopup(`<b>FIRMS Hotspot (${confidence})</b><br>Detected: ${date} ${time.substring(0,2)}:${time.substring(2)}<br>Brightness: ${brightness} K`); console.log(`[FIRMS Processing Line ${index + 1}] ADDING MARKER at ${lat}, ${lon}`); fireLayer.addLayer(marker); markerCount++; } else { console.warn(`[FIRMS Processing Line ${index + 1}] SKIPPED - Invalid lat/lon.`); } } else { console.warn(`[FIRMS Processing Line ${index + 1}] SKIPPED - Insufficient fields.`); } } catch (lineError) { console.error(`[FIRMS Processing Line ${index + 1}] Error:`, lineError, "Line:", line); } });
           console.log(`[FIRMS] Added ${markerCount} markers to fireLayer.`); if (markerCount > 0) { mapErrorMessage.style.display = 'none'; } else { console.log("[FIRMS] Processed CSV lines but no valid marker data found or added."); displayMapError('FIRMS data received but no valid hotspots found.'); }
      } catch (error) { console.error('[FIRMS] Error fetching or processing FIRMS data:', error); displayMapError(`Could not load FIRMS data: ${error.message}`);
      } finally { if (map) { if (showFires && !map.hasLayer(fireLayer)) { fireLayer.addTo(map); } else if (!showFires && map.hasLayer(fireLayer)) { fireLayer.remove(); } } mapLoadingMessage.style.display = 'none'; console.log("[FIRMS] Data loading finished."); } }
    async function loadNIFCFires() { /* ... same code ... */ }
    async function loadAirQuality(lat, lon) { /* ... same code ... */ }
    async function loadNWSWarnings() { /* ... same code ... */ }

    // --- Control Handlers & Helper Functions ---
    /* ... hamburger, navMenu, centerOnUserLocation, zoomToCA, zoomToUS, toggleFireLayers, toggleAirQuality, toggleNWSLayer, handleZipSearch, getAQIColor, displayMapError logic as before ... */
    hamburger.addEventListener('click', () => { /* ... */ }); navMenu.querySelectorAll('a').forEach(link => { /* ... */ });
    function centerOnUserLocation() { /* ... */ } function zoomToCA() { /* ... */ } function zoomToUS() { /* ... */ }
    function toggleFireLayers() { /* ... */ } function toggleAirQuality() { /* ... */ } function toggleNWSLayer() { /* ... */ }
    async function handleZipSearch(event) { /* ... */ }
    function getAQIColor(aqi) { /* ... */ } function displayMapError(message) { /* ... */ }

  </script>

</body>
</html>
