<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="description" content="Real-time wildfire tracking and emergency preparedness. Get live updates on active fires with NASA satellite data, location-based alerts, and comprehensive fire safety information.">
    <meta name="keywords" content="wildfire tracking, fire map, emergency preparedness, NASA FIRMS, real-time fires, wildfire alerts">
    <meta name="author" content="Eye on the Fire">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Eye on the Fire | Real-Time Wildfire Tracking">
    <meta property="og:description" content="Stay informed with real-time wildfire tracking powered by NASA satellite data. Get instant alerts and comprehensive fire safety information.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://eyeonthefire.com">
    <meta property="og:image" content="https://eyeonthefire.com/images/og-image.jpg">
    <meta property="og:site_name" content="Eye on the Fire">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Eye on the Fire | Real-Time Wildfire Tracking">
    <meta name="twitter:description" content="Stay informed with real-time wildfire tracking powered by NASA satellite data.">
    <meta name="twitter:image" content="https://eyeonthefire.com/images/twitter-card.jpg">
    
    <!-- Performance Critical Preloads -->
    <link rel="preload" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" as="style">
    <link rel="preload" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" as="script">
    <link rel="preload" href="/css/app.css" as="style">
    <link rel="preload" href="/js/app.js" as="script">
    
    <!-- DNS Prefetch for External Resources -->
    <link rel="dns-prefetch" href="//unpkg.com">
    <link rel="dns-prefetch" href="//tile.openstreetmap.org">
    <link rel="dns-prefetch" href="//nominatim.openstreetmap.org">
    <link rel="dns-prefetch" href="//analytics.google.com">
    
    <!-- Icons and Manifest -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="manifest" href="/manifest.json">
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#dc2626">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Eye on the Fire">
    
    <title>Eye on the Fire | Real-Time Wildfire Tracking & Emergency Preparedness</title>
    
    <!-- Critical CSS - Inline for Performance -->
    <style>
        /* Critical above-the-fold CSS */
        * { box-sizing: border-box; }
        html { -webkit-text-size-adjust: 100%; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.5; color: #111827; background-color: #f9fafb; overflow-x: hidden; }
        .app-container { display: flex; flex-direction: column; height: 100vh; position: relative; }
        #map { flex: 1; position: relative; z-index: 1; background-color: #a8dadc; }
        .loading-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255, 255, 255, 0.95); display: flex; align-items: center; justify-content: center; z-index: 2000; backdrop-filter: blur(2px); }
        .loading-spinner { width: 40px; height: 40px; border: 3px solid #e5e7eb; border-top: 3px solid #dc2626; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
    
    <!-- External Stylesheets -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="">
    <link rel="stylesheet" href="/css/app.css">
</head>
<body>
    <!-- Screen Reader Skip Link -->
    <a href="#main-content" class="sr-only">Skip to main content</a>
    
    <!-- Main Application Container -->
    <div class="app-container" id="app">
        <!-- Control Panel Header -->
        <header class="control-panel" role="banner">
            <h1 class="app-title">üî• Eye on the Fire</h1>
            
            <div class="status-info" role="status" aria-live="polite">
                <span class="fire-count" id="fireCount" aria-label="Number of active fires">Loading...</span>
                <span class="last-update" id="lastUpdate" aria-label="Last data update time">Initializing...</span>
            </div>
            
            <div class="control-actions">
                <button class="location-btn" id="locationBtn" aria-label="Get my location and show nearby fires" title="Find fires near me">
                    üìç Locate Me
                </button>
                <button class="refresh-btn" id="refreshBtn" onclick="eyeOnTheFire.refreshData()" aria-label="Refresh fire data" title="Refresh fire data">
                    üîÑ Refresh
                </button>
            </div>
            
            <!-- Current Location Display (Hidden by Default) -->
            <div class="current-location" id="currentLocation" style="display: none;" aria-live="polite"></div>
        </header>
        
        <!-- Main Map Container -->
        <main id="main-content" class="map-container" role="main" aria-label="Interactive fire map">
            <div id="map" aria-label="Map showing wildfire locations"></div>
            
            <!-- Loading Overlay -->
            <div class="loading-overlay" id="loadingOverlay" style="display: none;" aria-hidden="true">
                <div class="loading-spinner" aria-label="Loading"></div>
            </div>
            
            <!-- Loading Message -->
            <div class="loading-message" id="loadingMessage" role="status" aria-live="polite"></div>
        </main>
        
        <!-- Saved Places Panel (Hidden by Default) -->
        <aside class="saved-places-panel" id="savedPlacesPanel" style="display: none;" role="complementary" aria-label="Saved places">
            <div class="saved-places-header">
                üìå Saved Places
                <button class="close-btn" onclick="closeSavedPlaces()" aria-label="Close saved places panel">‚úï</button>
            </div>
            <div class="saved-places-list" id="saved-places-list" role="list">
                <!-- Saved places will be rendered here -->
            </div>
        </aside>
    </div>
    
    <!-- Emergency Information Modal (Hidden by Default) -->
    <div class="modal" id="emergencyModal" style="display: none;" role="dialog" aria-labelledby="emergency-modal-title" aria-modal="true" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="emergency-modal-title">üö® Emergency Information</h2>
                <button class="modal-close" onclick="closeModal('emergencyModal')" aria-label="Close emergency information">&times;</button>
            </div>
            <div class="modal-body">
                <div class="emergency-contacts">
                    <h3>Emergency Contacts</h3>
                    <ul>
                        <li><strong>Fire Emergency:</strong> <a href="tel:911">911</a></li>
                        <li><strong>Red Cross:</strong> <a href="tel:1-800-733-2767">1-800-RED-CROSS</a></li>
                        <li><strong>Evacuation Info:</strong> <a href="tel:211">211</a></li>
                    </ul>
                </div>
                <div class="safety-tips">
                    <h3>Fire Safety Tips</h3>
                    <ul>
                        <li>Create a family evacuation plan</li>
                        <li>Prepare an emergency kit</li>
                        <li>Clear defensible space around your home</li>
                        <li>Stay informed through official channels</li>
                        <li>Follow evacuation orders immediately</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Performance Analytics (Non-blocking) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'GA_MEASUREMENT_ID', {
            anonymize_ip: true,
            send_page_view: false
        });
        
        // Send page view after app loads
        window.addEventListener('load', () => {
            gtag('event', 'page_view', {
                page_title: 'Fire Map Application',
                page_location: window.location.href
            });
        });
    </script>
    
    <!-- Service Worker Registration -->
    <script>
        // Register service worker for offline functionality and caching
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }
    </script>
    
    <!-- Application Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="/js/app.js"></script>
    
    <!-- Additional Helper Functions -->
    <script>
        // Global helper functions for UI interactions
        function closeSavedPlaces() {
            const panel = document.getElementById('savedPlacesPanel');
            if (panel) panel.style.display = 'none';
        }
        
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
                modal.setAttribute('aria-hidden', 'true');
            }
        }
        
        function showEmergencyInfo() {
            const modal = document.getElementById('emergencyModal');
            if (modal) {
                modal.style.display = 'block';
                modal.setAttribute('aria-hidden', 'false');
                modal.focus();
            }
        }
        
        // Keyboard accessibility
        document.addEventListener('keydown', (event) => {
            // Close modals with Escape key
            if (event.key === 'Escape') {
                const openModals = document.querySelectorAll('.modal[style*="block"]');
                openModals.forEach(modal => {
                    modal.style.display = 'none';
                    modal.setAttribute('aria-hidden', 'true');
                });
                
                // Close saved places panel
                const savedPlacesPanel = document.getElementById('savedPlacesPanel');
                if (savedPlacesPanel && savedPlacesPanel.style.display !== 'none') {
                    savedPlacesPanel.style.display = 'none';
                }
            }
            
            // Emergency hotkey (Ctrl/Cmd + E)
            if ((event.ctrlKey || event.metaKey) && event.key === 'e') {
                event.preventDefault();
                showEmergencyInfo();
            }
        });
        
        // Performance monitoring
        window.addEventListener('load', () => {
            // Track load performance
            if ('performance' in window && 'getEntriesByType' in performance) {
                const navigation = performance.getEntriesByType('navigation')[0];
                if (navigation) {
                    const loadTime = navigation.loadEventEnd - navigation.loadEventStart;
                    console.log(`Page load time: ${loadTime}ms`);
                    
                    if (window.gtag) {
                        gtag('event', 'timing_complete', {
                            name: 'page_load',
                            value: Math.round(loadTime)
                        });
                    }
                }
            }
        });
        
        // Handle offline/online status
        window.addEventListener('online', () => {
            console.log('Connection restored');
            if (window.eyeOnTheFire && window.eyeOnTheFire.refreshData) {
                window.eyeOnTheFire.refreshData();
            }
        });
        
        window.addEventListener('offline', () => {
            console.log('Connection lost - using cached data');
        });
        
        // Handle visibility changes for performance
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                console.log('App hidden - reducing activity');
            } else {
                console.log('App visible - resuming normal activity');
                // Refresh data if app was hidden for more than 10 minutes
                const lastUpdate = window.appState?.lastUpdate;
                if (lastUpdate && Date.now() - lastUpdate > 10 * 60 * 1000) {
                    if (window.eyeOnTheFire && window.eyeOnTheFire.refreshData) {
                        window.eyeOnTheFire.refreshData();
                    }
                }
            }
        });
        
        // Handle URL parameters for deep linking
        window.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const lat = parseFloat(urlParams.get('lat'));
            const lng = parseFloat(urlParams.get('lng'));
            const zoom = parseInt(urlParams.get('zoom'));
            
            if (!isNaN(lat) && !isNaN(lng)) {
                // Wait for map to initialize, then set view
                setTimeout(() => {
                    if (window.appState && window.appState.map) {
                        window.appState.map.setView([lat, lng], zoom || 10);
                        console.log(`Deep link: Set view to ${lat}, ${lng}`);
                    }
                }, 1000);
            }
        });
    </script>
    
    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Eye on the Fire",
        "description": "Real-time wildfire tracking and emergency preparedness platform powered by NASA satellite data",
        "url": "https://eyeonthefire.com",
        "applicationCategory": "Emergency, Weather, Maps",
        "operatingSystem": "Web Browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "publisher": {
            "@type": "Organization",
            "name": "Eye on the Fire"
        },
        "screenshot": "https://eyeonthefire.com/images/screenshot.jpg",
        "featureList": [
            "Real-time wildfire tracking",
            "Location-based fire alerts", 
            "NASA satellite data integration",
            "Emergency preparedness information",
            "Mobile-optimized interface"
        ]
    }
    </script>
</body>
</html>
