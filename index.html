<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    {/* --- SEO & Meta Tags (Retained & Enhanced) --- */}
    <title>Eye on the Fire - Live Interactive Wildfire Map (California & US)</title>
    <meta name="description" content="Eye on the Fire: Your top resource for real-time wildfire monitoring via our live interactive fire map. Get crucial updates for fires near Moorpark, Ventura County, California, and the US. Access fire safety tips, prevention guides, and local emergency information.">
    <meta name="keywords" content="interactive fire map, live wildfire updates, fires near me, real-time fire monitoring, fire safety, Eye on the Fire, wildfire map, emergency preparedness, evacuation guide, California fire map, Moorpark fire, Ventura County fire, live fire tracker">
    <meta name="author" content="Eye on the Fire Team">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://eyeonthefire.com/"> {/* Adjust if domain changes */}
    <meta property="og:title" content="Eye on the Fire - Live Interactive Wildfire Map (California & US)">
    <meta property="og:description" content="Monitor active wildfires in Moorpark, California, and across the US with Eye on the Fire’s real-time interactive map. Get live updates, check fires near you, and find safety resources.">
    <meta property="og:url" content="https://eyeonthefire.com/"> {/* Adjust if domain changes */}
    <meta property="og:image" content="images/hero-bg.jpg"> {/* Ensure this image path is correct */}
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">

    {/* --- Favicons (Retained) --- */}
    <link rel="shortcut icon" href="favicon/favicon.ico" type="image/x-icon">
    <link rel="icon" type="image/png" href="favicon/favicon-96x96.png" sizes="96x96">
    <link rel="apple-touch-icon" href="favicon/apple-touch-icon.png" sizes="180x180">
    <meta name="apple-mobile-web-app-title" content="eyeonthefire">
    <link rel="manifest" href="favicon/site.webmanifest">

    {/* --- Analytics (Retained) --- */}
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-T8RE6KDBEW"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-T8RE6KDBEW');
    </script>

    {/* --- CSS Dependencies (Matched map-status.html) --- */}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    {/* --- Main Stylesheet --- */}
    <link rel="stylesheet" href="styles.css">

    {/* --- Schema Markup for SEO --- */}
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Eye on the Fire",
      "url": "https://eyeonthefire.com/", // Adjust if domain changes
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://eyeonthefire.com/#map-section?query={search_term_string}", // Example search action if applicable
        "query-input": "required name=search_term_string"
      },
       "description": "Real-time interactive wildfire map monitoring fires near you, live updates, and fire safety information for California and the US."
    }
    </script>
     <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": "Eye on the Fire - Live Interactive Wildfire Map (California & US)",
      "url": "https://eyeonthefire.com/", // Adjust if domain changes
      "description": "Homepage for Eye on the Fire, providing a live interactive fire map, wildfire updates, and safety resources for California and the US.",
       "breadcrumb": {
        "@type": "BreadcrumbList",
        "itemListElement": [{
          "@type": "ListItem",
          "position": 1,
          "name": "Home"
        }]
      }
    }
    </script>

</head>
<body>

    {/* --- Header (Matches map-status.html structure) --- */}
    <header class="navbar">
        <div class="navbar-container">
            <a href="#home" class="logo-link">
                 <div class="logo-container">
                    {/* <img src="images/fire-icon.png" alt="Eye on the Fire Logo Icon" style="height: 40px; width: auto;"> */}
                    <span>Eye on the Fire</span>
                 </div>
            </a>
            <button class="hamburger" aria-label="Toggle navigation" aria-expanded="false">
                <span class="line line1"></span>
                <span class="line line2"></span>
                <span class="line line3"></span>
            </button>
            {/* --- Navigation Menu (Matches map-status.html structure) --- */}
            <nav class="nav-menu" id="main-nav">
                 <ul class="main-menu">
                    <li><a href="#home">Home</a></li>
                    <li class="has-dropdown"> <a href="#">Prepare <i class="fas fa-caret-down"></i></a>
                        <ul class="dropdown">
                             <li><strong class="sub-header"><i class="fas fa-fire"></i> Get Ready</strong></li>
                             <li><a href="#prevention" class="sub-item">Hardening Your Home</a></li>
                             <li><a href="#prevention" class="sub-item">Defensible Space</a></li>
                             <li><a href="#prevention" class="sub-item">Defensible Space & Drought</a></li>
                             <li><a href="#prevention" class="sub-item">Fire-Smart Landscaping</a></li>
                             <li><strong class="sub-header"><i class="fas fa-fire"></i> Get Set</strong></li>
                             <li><a href="#" class="sub-item">Wildfire Action Plan</a></li>
                             <li><a href="#" class="sub-item">Prepare Your Family</a></li>
                             <li><a href="#" class="sub-item">Create Your Go Bag</a></li>
                             <li><a href="#" class="sub-item">Insurance Preparedness</a></li>
                             <li><strong class="sub-header"><i class="fas fa-fire"></i> Go!</strong></li>
                             <li><a href="#" class="sub-item">Go! Evacuation Guide</a></li>
                        </ul>
                    </li>
                    <li><a href="#prevention">Prevent</a></li>
                    <li class="has-dropdown">
                        <a href="#map-section">Map Tools <i class="fas fa-caret-down"></i></a>
                        <ul class="dropdown">
                            <li><a href="#">Layer Options</a></li>
                            <li><a href="#">Historical Data</a></li>
                            <li><a href="#">Submit Report</a></li>
                        </ul>
                    </li>
                     <li class="has-dropdown">
                        <a href="#">Safety Info <i class="fas fa-caret-down"></i></a>
                        <ul class="dropdown">
                             {/* Link these to specific pages or sections when available */}
                            <li><a href="#">Evacuation Plans</a></li>
                            <li><a href="#prevention">Prevention Tips</a></li>
                            <li><a href="#">Emergency Kit</a></li>
                        </ul>
                    </li>
                    <li><a href="#community">News</a></li>
                    <li><a href="#">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>

    {/* --- Hero Section (Retained, slight text adjustment) --- */}
    <section class="hero" id="home">
        <h1>Monitor Wildfires in Real-Time</h1>
        <p>Track active fires near you with our live interactive map. Get critical updates for California, including Moorpark & Ventura County, and across the US.</p>
        <a href="#map-section" class="cta-button">View Live Fire Map</a>
    </section>

    {/* --- Map Section (Working Map) --- */}
    <section id="map-section">
        {/* Heading styled by general h2 rules in styles.css */}
        <h2 style="text-align: center; margin-top: 2rem; color: var(--primary-color);">Interactive Live Wildfire Map</h2>
         {/* Paragraph styled by general p rules */}
         <p style="text-align: center; max-width: 800px; margin: 0 auto 1rem auto;">Monitor the latest wildfire activity with our <strong>real-time fire monitoring</strong> map. Use the controls to find <strong>fires near you</strong>, zoom to specific areas like <strong>Moorpark</strong> or greater <strong>Ventura County</strong>, and explore data layers.</p>
        <main>
            {/* React Map Component Renders Here */}
            <div id="root"></div>
        </main>
    </section>

    {/* --- About Section (Themed & Enhanced SEO Text) --- */}
    {/* Added a class 'themed-section-light' if you want to add specific light-bg theme styles later in CSS */}
    <section id="about" class="content-section themed-section-light">
        <div class="container">
        {/* Heading styled by general h2 rules */}
        <h2>Why Use Eye on the Fire?</h2>
         {/* Paragraph styled by general p rules */}
        <p>When wildfires threaten, timely information is vital. Eye on the Fire delivers the most current and comprehensive wildfire data through our premier <strong>interactive fire map</strong>. We integrate information from trusted sources, including NASA and NIFC, providing a clear view of <strong>live wildfire updates</strong> and <strong>fires near me</strong>. Whether you're in <strong>California</strong> or elsewhere, our <strong>real-time fire monitoring</strong> helps you understand the situation. Effective <strong>fire safety</strong> and <strong>emergency preparedness</strong> depend on reliable data – our platform provides the insights needed to stay safe.</p>
        </div>
    </section>

    {/* --- Prevention Section (Themed & Enhanced SEO Text) --- */}
    <section id="prevention" class="content-section themed-section-light">
        <div class="container">
        {/* Heading styled by general h2 rules */}
        <h2>Essential Wildfire Prevention Guides</h2>
        <p>Increase your home's resilience to wildfires with proactive <strong>fire prevention</strong>. Implementing key <strong>fire safety</strong> measures creates a defensible space, significantly improving the chances of your property surviving an ember storm or advancing flames. This is crucial for homeowners in areas like <strong>Moorpark</strong> and <strong>Ventura County</strong>.</p>
        {/* Grid items inherit general styles, can be customized further if needed */}
        <div class="prevention-grid">
            <div class="prevention-item"><h3>Establish Defensible Space</h3><p>Maintain zones around your home (30-100ft) clear of flammable materials. Remove dead plants, dry leaves, and prune trees. This is a primary step in any <strong>wildfire action plan</strong>.</p></div>
            <div class="prevention-item"><h3>Home Hardening Basics</h3><p>Regularly clean roofs and gutters. Use non-combustible materials for roofing and siding where possible. Screen vents to block embers. These steps are vital for <strong>hardening your home</strong> against wildfire.</p></div>
            <div class="prevention-item"><h3>Fire-Smart Landscaping</h3><p>Choose fire-resistant, drought-tolerant plants. Avoid placing flammable vegetation near structures. Proper landscaping complements your <strong>defensible space</strong> efforts.</p></div>
        </div>
        {/* Add a link to a more detailed prevention page if available */}
        {/* <p style="text-align: center; margin-top: 1.5rem;"><a href="#" class="cta-button-small">Learn More Prevention Tips</a></p> */}
        </div>
    </section>

    {/* --- Community Section (Themed & Enhanced Alt Text) --- */}
    <section id="community" class="content-section themed-section-light">
        <div class="container">
             {/* Heading styled by general h2 rules */}
            <h2>Local Resources & Community Updates</h2>
            <p>Access local emergency information and stay updated during wildfire events in your area.</p>
            {/* Link styled by general a rules */}
            <div class="cta-banner"><p>Find official resources for Ventura County: <a href="#" target="_blank" rel="noopener noreferrer">VC Emergency Website</a></p></div>
             {/* Gallery items inherit general styles */}
            <div class="gallery">
                <div class="gallery-item"><img src="images/community-1.jpg" alt="Community volunteers clearing brush for fire prevention in Southern California"></div>
                <div class="gallery-item"><img src="images/community-2.jpg" alt="Firefighters coordinating efforts during a California wildfire"></div>
                <div class="gallery-item"><img src="images/community-3.jpg" alt="Green landscape showing signs of regrowth after a wildfire passed through"></div>
            </div>
        </div>
    </section>

    {/* --- Footer (Matches map-status.html structure & styling) --- */}
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-section about">
                 <h3 class="logo-text-footer">Eye on the Fire</h3>
                <p>
                    Your premier source for real-time wildfire monitoring and safety information. Stay informed, stay safe with our live interactive fire map.
                </p>
            </div>
            <div class="footer-section links">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="#map-section">Live Map</a></li>
                    <li><a href="#prevention">Safety Tips</a></li>
                    <li><a href="#community">News/Resources</a></li>
                    <li><a href="#about">About Us</a></li>
                    <li><a href="#">Contact</a></li>
                </ul>
            </div>
            <div class="footer-section social">
                <h3>Follow Us</h3>
                <div class="social-icons">
                    {/* Add your actual social media links */}
                    <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                    <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                    <a href="#" aria-label="RSS Feed"><i class="fas fa-rss"></i></a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            &copy; <span id="year"></span> Eye on the Fire | All Rights Reserved |
            <a href="#">Terms of Use</a> |
            <a href="#">Privacy Policy</a>
        </div>
    </footer>

    {/* --- Script Dependencies (Map & React) --- */}
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react@17/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7/babel.min.js"></script>

    {/* --- React Map Component --- */}
    <script type="text/babel">
        // React Map Component code remains the same as previous version...
        const { useState, useEffect, useRef } = React;

        const fetchWithRetry = async (url, retries = 3, delay = 1000) => {
            for (let i = 0; i < retries; i++) {
                let response;
                try {
                    response = await fetch(url);
                    if (!response.ok) {
                        const errorText = await response.text();
                        throw new Error(`HTTP error ${response.status}: ${errorText || response.statusText}`);
                    }
                    return await response.json();
                } catch (error) {
                    // Avoid logging retry attempts in the final version unless debugging
                    // console.error(`Data fetch attempt ${i + 1} failed:`, error.message);
                    if (i === retries - 1) throw error;
                    // console.log(`Retrying fetch in ${delay}ms...`);
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        };

        const MapComponent = () => {
            const [fires, setFires] = useState([]);
            const [center, setCenter] = useState([34.2800, -118.7367]); // Centered near Moorpark/Simi
            const [zoom, setZoom] = useState(9); // Zoomed in slightly more
            const [errorMessage, setErrorMessage] = useState('');
            const [isLoading, setIsLoading] = useState(true);
            const mapRef = useRef(null);
            const markerLayerRef = useRef(null);
            const initialCenter = [34.2800, -118.7367]; // Store initial default
            const initialZoom = 9;
            const loadingOverlayRef = useRef(null);

            useEffect(() => {
                if (!mapRef.current) {
                    mapRef.current = L.map('map', {
                        zoomControl: true
                    }).setView(center, zoom);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '&copy; OpenStreetMap contributors | Eye on the Fire'
                    }).addTo(mapRef.current);
                    markerLayerRef.current = L.markerClusterGroup().addTo(mapRef.current);
                     mapRef.current.zoomControl.setPosition('topright');
                }
            }, []);

            useEffect(() => {
                if (mapRef.current) {
                    mapRef.current.setView(center, zoom);
                }
            }, [center, zoom]);

            useEffect(() => {
                setIsLoading(true);
                setErrorMessage('');
                 if (loadingOverlayRef.current) loadingOverlayRef.current.classList.remove('hidden');

                const fireApiUrl = 'https://eyeonthefire.com/api/nasa/'; // Make sure this API endpoint is correct

                fetchWithRetry(fireApiUrl)
                    .then(data => {
                        // console.log('Fire data received:', data); // Disable console log for production
                        const fireList = (data.events || []).map(event => ({
                            lat: event.geometry[0].coordinates[1],
                            lon: event.geometry[0].coordinates[0],
                            title: event.title || 'Active Fire'
                        }));
                        setFires(fireList.slice(0, 200));
                    })
                    .catch(err => {
                        console.error('Error fetching fire data:', err.message); // Keep error log
                        setErrorMessage(`Failed to load fire data. Please check API or network.`);
                    })
                    .finally(() => {
                         setIsLoading(false);
                         if (loadingOverlayRef.current) loadingOverlayRef.current.classList.add('hidden');
                    });
            }, []);


            useEffect(() => {
                if (markerLayerRef.current) {
                    markerLayerRef.current.clearLayers();
                    const fireIcon = L.icon({
                        iconUrl: 'images/fire-icon.png', // Ensure this path is correct
                        iconSize: [32, 32], iconAnchor: [16, 32], popupAnchor: [0, -32]
                    });

                    fires.forEach(fire => {
                        L.marker([fire.lat, fire.lon], { icon: fireIcon })
                            .bindPopup(fire.title)
                            .addTo(markerLayerRef.current);
                    });
                }
            }, [fires]);

            const handleReset = () => { setCenter(initialCenter); setZoom(initialZoom); setErrorMessage(''); };

            const handleLocateMe = () => {
                 setIsLoading(true); setErrorMessage('');
                 if (loadingOverlayRef.current) loadingOverlayRef.current.classList.remove('hidden');
                 if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        position => {
                            const { latitude, longitude } = position.coords;
                            setCenter([latitude, longitude]); setZoom(12);
                            setIsLoading(false);
                            if (loadingOverlayRef.current) loadingOverlayRef.current.classList.add('hidden');
                        },
                        err => {
                            console.error('Geolocation error:', err.message); // Keep error log
                            setErrorMessage('Failed to get location: ' + err.message);
                            setIsLoading(false);
                            if (loadingOverlayRef.current) loadingOverlayRef.current.classList.add('hidden');
                        },
                         { enableHighAccuracy: true, timeout: 8000, maximumAge: 0 }
                    );
                } else {
                    setErrorMessage('Geolocation not supported');
                    setIsLoading(false);
                    if (loadingOverlayRef.current) loadingOverlayRef.current.classList.add('hidden');
                }
            };

            const dismissError = () => setErrorMessage('');

            return (
                <>
                    <div className="map-container">
                         <div ref={loadingOverlayRef} className="loading-overlay">
                             <div className="flame-loader"></div>
                             <p>Loading live fire data...</p>
                         </div>
                        <div className="controls">
                            <button onClick={handleReset}>Reset View</button>
                            <button onClick={handleLocateMe}>Locate Me</button>
                        </div>
                        {errorMessage && (
                            <div className="error-message">
                                <span>{errorMessage}</span>
                                <button onClick={dismissError} aria-label="Dismiss error">×</button>
                            </div>
                        )}
                        <div id="map"></div>
                    </div>
                </>
            );
        };

        ReactDOM.render(<MapComponent />, document.getElementById('root'));
    </script>

    {/* --- Vanilla JS for Menu Toggle & Footer Year --- */}
    <script>
        // Hamburger Menu & Footer Year JS remains the same as previous version...
        document.addEventListener('DOMContentLoaded', () => {
            const hamburger = document.querySelector('.hamburger');
            const navMenu = document.querySelector('.nav-menu');
            const mainNavLinks = document.querySelectorAll('.main-menu a');

            if (hamburger && navMenu) {
                 hamburger.addEventListener('click', () => {
                    const isActive = navMenu.classList.contains('active');
                    hamburger.classList.toggle('active');
                    navMenu.classList.toggle('active');
                    hamburger.setAttribute('aria-expanded', !isActive);

                    if (!navMenu.classList.contains('active')) {
                        document.querySelectorAll('.main-menu .has-dropdown.open').forEach(openDropdown => {
                            openDropdown.classList.remove('open');
                            const caret = openDropdown.querySelector('a > i.fa-caret-down');
                            if(caret) caret.style.transform = '';
                        });
                    }
                 });
            }

             if (navMenu) {
                 const dropdownToggles = navMenu.querySelectorAll('.main-menu .has-dropdown > a');
                 dropdownToggles.forEach(toggleLink => {
                     toggleLink.addEventListener('click', (e) => {
                         if (hamburger && window.getComputedStyle(hamburger).display !== 'none') {
                             e.preventDefault();
                             const parentLi = toggleLink.closest('.has-dropdown');
                             if (parentLi) {
                                const currentlyOpen = parentLi.classList.contains('open');
                                document.querySelectorAll('.main-menu .has-dropdown.open').forEach(otherLi => {
                                     if (otherLi !== parentLi) {
                                         otherLi.classList.remove('open');
                                          const otherCaret = otherLi.querySelector('a > i.fa-caret-down');
                                          if(otherCaret) otherCaret.style.transform = '';
                                     }
                                 });
                                parentLi.classList.toggle('open', !currentlyOpen);
                                const caret = toggleLink.querySelector('i.fa-caret-down');
                                if (caret) {
                                    caret.style.transform = parentLi.classList.contains('open') ? 'rotate(180deg)' : '';
                                }
                             }
                         }
                         // Allow default link behavior on desktop for dropdown toggles with href
                         else if (toggleLink.getAttribute('href') && toggleLink.getAttribute('href') !== '#') {
                            // Allow normal navigation
                         } else {
                             e.preventDefault(); // Prevent default for '#' links on desktop too
                         }
                     });
                 });

                 mainNavLinks.forEach(link => {
                    const isToggle = link.matches('.has-dropdown > a');
                    const isInDropdown = link.closest('.dropdown') !== null;

                    if (!isToggle || (isInDropdown && hamburger && navMenu.classList.contains('active'))) {
                         link.addEventListener('click', (e) => {
                             // Only close menu if mobile is active
                             if (hamburger && navMenu.classList.contains('active')) {
                                // Check if it's a link to a section on the same page
                                const href = link.getAttribute('href');
                                if (href && href.startsWith('#')) {
                                   // Allow default scroll behavior
                                }

                                // Close menu
                                hamburger.classList.remove('active');
                                navMenu.classList.remove('active');
                                hamburger.setAttribute('aria-expanded', 'false');
                                document.querySelectorAll('.main-menu .has-dropdown.open').forEach(openDropdown => {
                                    openDropdown.classList.remove('open');
                                    const caret = openDropdown.querySelector('a > i.fa-caret-down');
                                    if(caret) caret.style.transform = '';
                                });
                             }
                         });
                     }
                 });
             }

            const yearSpan = document.getElementById('year');
            if (yearSpan) {
                 yearSpan.textContent = new Date().getFullYear();
            }
        });
    </script>

</body>
</html>
