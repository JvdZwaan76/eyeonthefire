<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Eye on the Fire - Premier Interactive Fire Map & Live Updates</title>
  <meta name="description" content="Eye on the Fire is your premier destination to monitor active wildfires near you with our interactive live map. Get real-time updates, safety tips, and community insights instantly.">
  <meta name="keywords" content="interactive fire map, live wildfire updates, fires near me, real-time fire monitoring, fire safety, Eye on the Fire">
  <meta name="author" content="Eye on the Fire Team">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://eyeonthefire.com/">
  <meta property="og:title" content="Eye on the Fire - Premier Interactive Fire Map">
  <meta property="og:description" content="Monitor active wildfires near you with Eye on the Fire’s interactive live map. Stay updated with real-time fire data and safety resources.">
  <meta property="og:url" content="https://eyeonthefire.com/">
  <meta property="og:image" content="/images/hero-bg.jpg">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">
  <link rel="shortcut icon" href="/favicon/favicon.ico" type="image/x-icon">
  <link rel="icon" type="image/png" href="/favicon/favicon-96x96.png" sizes="96x96">
  <link rel="apple-touch-icon" href="/favicon/apple-touch-icon.png" sizes="180x180">
  <meta name="apple-mobile-web-app-title" content="eyeonthefire">
  <link rel="manifest" href="/favicon/site.webmanifest">
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-T8RE6KDBEW"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-T8RE6KDBEW');
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <link rel="stylesheet" href="/styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;700&family=Open+Sans:wght@300;400&display=swap" rel="stylesheet">
</head>
<body>
  <nav class="navbar">
    <div class="logo">
      <img src="/images/logo.png" alt="Eye on the Fire Logo">
      <span class="logo-text">Eye on the Fire</span>
    </div>
    <div class="hamburger" onclick="toggleMenu()">
      <span class="line"></span>
      <span class="line"></span>
      <span class="line"></span>
    </div>
    <ul class="nav-menu">
      <li><a href="#map-section" style="color: #ffca28;">Fire Map</a></li>
      <li><a href="recent-fires.html">Recent Fires</a></li>
      <li><a href="#prevention">Prevention</a></li>
      <li><a href="#community">Community</a></li>
      <li><a href="about.html">About</a></li>
      <li><a href="status.html">Status</a></li>
    </ul>
  </nav>
  <header class="hero">
    <h1>Your Premier Fire Monitoring Hub</h1>
    <p>Track active wildfires near you with our cutting-edge interactive map.</p>
    <a href="#map-section" class="cta-button">Start Monitoring Now</a>
  </header>

  <section class="map-section" id="map-section">
    <div class="map-container" id="map-container">
      <div class="map-header">Interactive Live Fire Map</div>
      <div class="map-controls">
        <button onclick="zoomToCA()" aria-label="Zoom to California">Zoom to CA</button>
        <button onclick="zoomToUS()" aria-label="View entire U.S.">View U.S.</button>
        <button onclick="toggleFires()" aria-label="Toggle active fire markers">Toggle Fires</button>
        <button onclick="toggleAirQuality()" aria-label="Toggle air quality markers">Toggle Air Quality</button>
        <button onclick="toggleFullscreen()" aria-label="Toggle fullscreen mode">Fullscreen</button>
      </div>
      <div id="fire-map"></div>
    </div>
    <div class="location-form-container">
      <div class="location-form">
        <input type="text" id="zip-input" placeholder="Enter Zip Code" aria-label="Zip Code">
        <button onclick="checkFiresNow()" aria-label="Check fires near zip code">Check Fires Now</button>
        <p class="disclosure">USA & Canada only</p>
        <button class="close-form" onclick="hideZipForm()" aria-label="Close zip code form">×</button>
      </div>
    </div>
  </section>

  <section class="content-section">
    <h2>Why Eye on the Fire?</h2>
    <p>Eye on the Fire is the ultimate destination for real-time wildfire tracking. Our interactive map delivers live updates on active fires near you, empowering you with the information to stay safe and informed.</p>
    <a href="#map-section" class="cta-button">Explore the Fire Map</a>
  </section>

  <section id="prevention" class="content-section">
    <h2>Stay Safe with Expert Tips</h2>
    <div class="prevention-grid">
      <div class="prevention-item">
        <h3>Defensible Space</h3>
        <p>Clear vegetation within 30 feet of your home to reduce fire risk.</p>
      </div>
      <div class="prevention-item">
        <h3>Smoke Alarms</h3>
        <p>Test detectors monthly for early fire detection.</p>
      </div>
      <div class="prevention-item">
        <h3>Evacuation Plan</h3>
        <p>Plan and practice escape routes for emergencies.</p>
      </div>
    </div>
    <div class="cta-banner">Monitor Fires Now! <a href="#map-section">Check the Live Map</a></div>
  </section>

  <section id="community" class="content-section">
    <h2>Join Our Community</h2>
    <p>Connect with others, share experiences, and stay updated on active fires through our interactive platform.</p>
    <div class="gallery">
      <div class="gallery-item"><img src="/images/gallery-firefighter.jpg" alt="Firefighter battling blaze"></div>
      <div class="gallery-item"><img src="/images/gallery-aftermath.jpg" alt="Community wildfire recovery"></div>
    </div>
    <a href="recent-fires.html" class="cta-button">See Recent Fires</a>
  </section>

  <footer>
    <p>© 2025 Eye on the Fire | <a href="#privacy">Privacy</a> | <a href="#terms">Terms</a> | <a href="/status.html">Status</a></p>
    <div class="social-icons">
      <a href="https://twitter.com/eyeonthefire" target="_blank" rel="nofollow" aria-label="Follow us on Twitter"><i class="fab fa-twitter"></i></a>
      <a href="https://facebook.com/eyeonthefire" target="_blank" rel="nofollow" aria-label="Follow us on Facebook"><i class="fab fa-facebook-f"></i></a>
      <a href="https://instagram.com/eyeonthefire" target="_blank" rel="nofollow" aria-label="Follow us on Instagram"><i class="fab fa-instagram"></i></a>
    </div>
    <div class="cta-banner">Stay Ahead! <a href="#map-section">Track Fires Live</a></div>
  </footer>

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "Eye on the Fire",
    "url": "https://eyeonthefire.com/",
    "description": "The premier destination for interactive live wildfire monitoring, real-time updates, and fire safety resources.",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "https://eyeonthefire.com/#map-section?q={search_term_string}",
      "query-input": "required name=search_term_string"
    }
  }
  </script>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script>
    let map, fireLayer, airQualityLayer;
    let showFires = true, showAirQuality = false;
    const FIRMS_API_KEY = 'd152217c8391eb5b0fbd242290527ae8';
    const AIRNOW_API_KEY = '54044855-7B0C-4023-BEE4-8B3FCA172DED';
    const OPENCAGE_API_KEY = 'a40b9e954e50458bbc09ca24e70201a1';

    const observer = new IntersectionObserver((entries) => {
      if (entries[0].isIntersecting && !map) {
        initMap();
        loadFireData();
        observer.unobserve(document.getElementById('map-container'));
        setInterval(loadFireData, 900000);
      }
    });
    observer.observe(document.getElementById('map-container'));

    function initMap() {
      map = L.map('fire-map').setView([34.0522, -118.2437], 10);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> | Data: FIRMS, NIFC, AirNow, NOAA'
      }).addTo(map);
      fireLayer = L.layerGroup().addTo(map);
      airQualityLayer = L.layerGroup();

      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
          map.setView([pos.coords.latitude, pos.coords.longitude], 10);
        }, () => console.log('Geolocation denied'));
      }
    }

    async function loadFireData(lat = 34.0522, lon = -118.2437) {
      fireLayer.clearLayers();
      airQualityLayer.clearLayers();
      console.log('Loading fire data for lat:', lat, 'lon:', lon);

      // FIRMS Hotspots
      try {
        const firmsUrl = `https://firms.modaps.eosdis.nasa.gov/api/area/csv/${FIRMS_API_KEY}/VIIRS_SNPP_NRT/-125,25,-65,50/1`;
        const firmsResponse = await fetch(firmsUrl);
        if (!firmsResponse.ok) throw new Error(`FIRMS API failed: ${firmsResponse.status}`);
        const firmsText = await firmsResponse.text();
        const firmsLines = firmsText.split('\n').slice(1);
        console.log('FIRMS lines:', firmsLines.length);
        let markerCount = 0;
        firmsLines.forEach(line => {
          const [latitude, longitude, , , acqDate, acqTime] = line.split(',');
          if (latitude && longitude && !isNaN(parseFloat(latitude)) && !isNaN(parseFloat(longitude))) {
            L.marker([parseFloat(latitude), parseFloat(longitude)], { 
              icon: L.icon({ iconUrl: '/images/fire-icon.png', iconSize: [25, 25] }) 
            })
              .addTo(fireLayer)
              .bindPopup(`FIRMS Hotspot<br>Detected: ${acqDate} ${acqTime}`);
            markerCount++;
          }
        });
        console.log('FIRMS markers added:', markerCount);
      } catch (e) { 
        console.error('FIRMS Error:', e.message); 
      }

      // NIFC Fire Perimeters
      try {
        const nifcUrl = 'https://services3.arcgis.com/T4QMspbfLg3qTGWY/arcgis/rest/services/Current_WildlandFires/FeatureServer/0/query?where=1%3D1&outFields=IncidentName,Acres,PercentContained&returnGeometry=true&f=geojson';
        const nifcResponse = await fetch(nifcUrl);
        if (!nifcResponse.ok) throw new Error(`NIFC API failed: ${nifcResponse.status}`);
        const nifcData = await nifcResponse.json();
        console.log('NIFC features:', nifcData.features.length);
        let markerCount = 0;
        nifcData.features.forEach(feature => {
          const { coordinates } = feature.geometry;
          const { IncidentName, Acres, PercentContained } = feature.properties;
          if (coordinates && coordinates.length >= 2 && !isNaN(coordinates[1]) && !isNaN(coordinates[0])) {
            L.marker([coordinates[1], coordinates[0]], { 
              icon: L.icon({ iconUrl: '/images/fire-icon.png', iconSize: [25, 25] }) 
            })
              .addTo(fireLayer)
              .bindPopup(`<b>${IncidentName}</b><br>Acres: ${Acres}<br>Contained: ${PercentContained}%`);
            markerCount++;
          }
        });
        console.log('NIFC markers added:', markerCount);
      } catch (e) { 
        console.error('NIFC Error:', e.message); 
      }

      // AirNow Air Quality
      try {
        const airNowUrl = `https://www.airnowapi.org/aq/observation/latLong/current/?format=application/json&latitude=${lat}&longitude=${lon}&distance=100&API_KEY=${AIRNOW_API_KEY}`;
        const airNowResponse = await fetch(airNowUrl);
        if (!airNowResponse.ok) throw new Error(`AirNow API failed: ${airNowResponse.status}`);
        const airNowData = await airNowResponse.json();
        console.log('AirNow stations:', airNowData.length);
        let markerCount = 0;
        airNowData.forEach(station => {
          const { Latitude, Longitude, AQI, ParameterName, Category } = station;
          if (ParameterName === 'PM2.5' && Latitude && Longitude && !isNaN(Latitude) && !isNaN(Longitude)) {
            L.circleMarker([Latitude, Longitude], { 
              radius: 10, 
              color: aqiColor(AQI), 
              fillOpacity: 0.5 
            })
              .addTo(airQualityLayer)
              .bindPopup(`PM2.5 AQI: ${AQI}<br>Category: ${Category.Name}`);
            markerCount++;
          }
        });
        console.log('AirNow markers added:', markerCount);
      } catch (e) { 
        console.error('AirNow Error:', e.message); 
      }

      // NOAA Fire Weather Alerts
      try {
        const nwsUrl = 'https://api.weather.gov/alerts/active?event=Fire%20Weather%20Watch';
        const nwsResponse = await fetch(nwsUrl, { headers: { 'User-Agent': 'EyeOnTheFire (info@eyeonthefire.com)' } });
        if (!nwsResponse.ok) throw new Error(`NOAA API failed: ${nwsResponse.status}`);
        const nwsData = await nwsResponse.json();
        console.log('NOAA alerts:', nwsData.features.length);
        let alertCount = 0;
        nwsData.features.forEach(alert => {
          const { coordinates } = alert.geometry;
          if (coordinates && coordinates[0]) {
            L.polygon(coordinates[0].map(coord => [coord[1], coord[0]]), { 
              color: '#ff4500', 
              fillOpacity: 0.3 
            })
              .addTo(fireLayer)
              .bindPopup(alert.properties.headline);
            alertCount++;
          }
        });
        console.log('NOAA alerts added:', alertCount);
      } catch (e) { 
        console.error('NOAA Error:', e.message); 
      }

      if (!map.hasLayer(fireLayer)) {
        fireLayer.addTo(map);
        console.log('fireLayer added to map');
      }
    }

    function aqiColor(aqi) {
      if (aqi <= 50) return '#00e400';
      if (aqi <= 100) return '#ffff00';
      if (aqi <= 150) return '#ff7e00';
      if (aqi <= 200) return '#ff0000';
      if (aqi <= 300) return '#8f3f97';
      return '#7e0023';
    }

    async function checkFiresNow() {
      const zip = document.getElementById('zip-input').value.trim();
      const usZipRegex = /^\d{5}$/;
      const caZipRegex = /^[A-Za-z]\d[A-Za-z][ -]?\d[A-Za-z]\d$/;

      if (!usZipRegex.test(zip) && !caZipRegex.test(zip)) {
        alert('Please enter a valid USA (e.g., 90210) or Canadian (e.g., V6B 2W9) zip code.');
        return;
      }

      try {
        const response = await fetch(`https://api.opencagedata.com/geocode/v1/json?q=${zip}&key=${OPENCAGE_API_KEY}&countrycode=us,ca&limit=1`);
        const data = await response.json();
        if (data.results.length > 0) {
          const { lat, lng } = data.results[0].geometry;
          map.setView([lat, lng], 10);
          loadFireData(lat, lng);
        } else {
          alert('Zip code not found in USA or Canada. Please try again.');
        }
      } catch (e) {
        console.error('Geocoding Error:', e);
        alert('Error finding location. Please try again.');
      }
    }

    function zoomToCA() { map.setView([36.7783, -119.4179], 6); }
    function zoomToUS() { map.setView([37.0902, -95.7129], 4); }
    function toggleFires() {
      showFires = !showFires;
      showFires ? fireLayer.addTo(map) : fireLayer.remove();
    }
    function toggleAirQuality() {
      showAirQuality = !showAirQuality;
      showAirQuality ? airQualityLayer.addTo(map) : airQualityLayer.remove();
    }
    function toggleFullscreen() {
      document.getElementById('map-container').classList.toggle('fullscreen');
      map.invalidateSize();
    }

    function toggleMenu() {
      document.querySelector('.nav-menu').classList.toggle('active');
      document.querySelector('.hamburger').classList.toggle('active');
    }

    function hideZipForm() {
      document.querySelector('.location-form-container').style.display = 'none';
    }
  </script>
</body>
</html>
